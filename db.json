{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/images/weekend.jpeg","path":"images/weekend.jpeg","modified":0,"renderable":0},{"_id":"themes/archer/source/assets/algolia_logo.svg","path":"assets/algolia_logo.svg","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/favicon.ico","path":"assets/favicon.ico","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/loading.svg","path":"assets/loading.svg","modified":0,"renderable":1},{"_id":"themes/archer/source/assets/qr.png","path":"assets/qr.png","modified":0,"renderable":1},{"_id":"themes/archer/source/avatar/logo.jpg","path":"avatar/logo.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/css/mobile.css","path":"css/mobile.css","modified":0,"renderable":1},{"_id":"themes/archer/source/css/style.css","path":"css/style.css","modified":0,"renderable":1},{"_id":"themes/archer/source/font/Source Sans Pro.woff","path":"font/Source Sans Pro.woff","modified":0,"renderable":1},{"_id":"themes/archer/source/font/Source Sans Pro.woff2","path":"font/Source Sans Pro.woff2","modified":0,"renderable":1},{"_id":"themes/archer/source/lib/webfontloader.min.js","path":"lib/webfontloader.min.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/search.js","path":"scripts/search.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/main.js","path":"scripts/main.js","modified":0,"renderable":1},{"_id":"themes/archer/source/scripts/share.js","path":"scripts/share.js","modified":0,"renderable":1},{"_id":"source/images/travis.png","path":"images/travis.png","modified":0,"renderable":0},{"_id":"themes/archer/source/font/Oswald-Regular.ttf","path":"font/Oswald-Regular.ttf","modified":0,"renderable":1},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff","path":"font/SourceCodePro-Regular.ttf.woff","modified":0,"renderable":1},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff2","path":"font/SourceCodePro-Regular.ttf.woff2","modified":0,"renderable":1},{"_id":"themes/archer/source/intro/404-bg.jpg","path":"intro/404-bg.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/lib/jquery.min.js","path":"lib/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/archer/source/avatar/avtar.jpg","path":"avatar/avtar.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/intro/about-bg.jpg","path":"intro/about-bg.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/intro/bg.jpg","path":"intro/bg.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/intro/post-bg.jpg","path":"intro/post-bg.jpg","modified":0,"renderable":1},{"_id":"themes/archer/source/intro/index-bg.jpg","path":"intro/index-bg.jpg","modified":0,"renderable":1},{"_id":"source/images/login.png","path":"images/login.png","modified":1,"renderable":0},{"_id":"source/images/encrypt.png","path":"images/encrypt.png","modified":1,"renderable":0},{"_id":"source/images/iv.png","path":"images/iv.png","modified":1,"renderable":0}],"Cache":[{"_id":"themes/archer/.eslintrc.json","hash":"35eeca97fa5a2d0c6d78ef1257c58f03c42d43df","modified":1566989305195},{"_id":"themes/archer/.gitattributes","hash":"82c1a621642d5b620275ae1ed59845c3f7015a64","modified":1566989305195},{"_id":"themes/archer/.gitignore","hash":"e2d7fa953bade3b94ed1cab25ffcf442c7540433","modified":1566989305196},{"_id":"themes/archer/.prettierignore","hash":"58caf761f07e5df9cdc21f7f19f0670fde41089b","modified":1566989305196},{"_id":"themes/archer/.prettierrc.js","hash":"875b0b95f6eb24a23e4ea83a75709b97897135e0","modified":1566989305196},{"_id":"themes/archer/LICENSE","hash":"0da0c361bf299375739c6b668a44af0f5faf37bb","modified":1566989305196},{"_id":"themes/archer/_config.yml","hash":"bdb870dbbc5c90e9e01f502e2428cbc81da111fb","modified":1567240624770},{"_id":"themes/archer/README.md","hash":"97edb54cb7aecff714f132110ed4ba8215da7136","modified":1566989305197},{"_id":"themes/archer/gulpfile.js","hash":"46dfe693b00ac4dea4d1b1af56f5ced4ee095c10","modified":1566989305199},{"_id":"themes/archer/package.json","hash":"531fe40833ca63493f62adfa249b6434310a2d0a","modified":1566989305207},{"_id":"themes/archer/webpack.config.js","hash":"d20b6350c50e2981484cb9356a3e21a2124bcd72","modified":1566989305236},{"_id":"themes/archer/webpack.prod.js","hash":"48de76cfa6274895801d3afc89ecbf04ee182a1c","modified":1566989305236},{"_id":"source/_posts/Travis-CI持续集成Hexo到云服务器.md","hash":"9e646d89bd8be30d3fa4fc51de9b8421b5c249c0","modified":1567341329894},{"_id":"source/_posts/nginx配置ssl.md","hash":"65fd09f5d823e747d7c64ee5a36faff40ae30583","modified":1567310891816},{"_id":"source/_posts/weekend.md","hash":"ff8eef9ec07441c3ffcbc32fa1e5ff9d68f9599d","modified":1567306601461},{"_id":"source/_posts/新网站.md","hash":"561a1121c21834250862620b2d39ff7649c7f71d","modified":1567240572599},{"_id":"source/about/index.md","hash":"31da4ed509e6c46b81eeb4b109a5ec6cb16deb3d","modified":1567159452263},{"_id":"source/tags/index.md","hash":"594f738b83fedfa653d5c96da20510c8ea8b0de4","modified":1566911678021},{"_id":"themes/archer/.git/COMMIT_EDITMSG","hash":"9ca1c0d10ff15ab10d4bc3a58f956b93b49f2d12","modified":1567158111363},{"_id":"themes/archer/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1566989305189},{"_id":"themes/archer/.git/config","hash":"6998f51f0cc705be211a46fe87abdcd373a68c70","modified":1566989305190},{"_id":"themes/archer/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1566989299704},{"_id":"themes/archer/.git/index","hash":"5ea9946f867fe462b035a168dc7956f6077a4f24","modified":1567232713984},{"_id":"themes/archer/.git/packed-refs","hash":"e6bb720318e32c3c1b55e1dd99bf981a6b74be00","modified":1566989305187},{"_id":"themes/archer/.git/shallow","hash":"277214e2809b9c62a00a663f98cf5a4a8204a215","modified":1566989302716},{"_id":"themes/archer/dev/archer.sh","hash":"4065c4e55462d5ecf016464adea0d1db967ef4b4","modified":1566989305197},{"_id":"themes/archer/docs/develop-guide-en.md","hash":"0bb09c3c9d5f56820cb84e3316f60352b731d70c","modified":1566989305197},{"_id":"themes/archer/docs/README-en.md","hash":"f325565c0bb94501fd046268659c7752709895d1","modified":1566989305197},{"_id":"themes/archer/docs/develop-guide-zh.md","hash":"effc2bc9e0cecfd228b19283337ff29649ea5985","modified":1566989305197},{"_id":"themes/archer/languages/default.yml","hash":"d56b6923c70efdef09cd1f0270d7adc9cc338f6b","modified":1566989305199},{"_id":"themes/archer/languages/en.yml","hash":"ad75d3e5f7f5f0463d3077e1b5a26f40938a1faa","modified":1566989305199},{"_id":"themes/archer/layout/404.ejs","hash":"879641b1b5e49c43f2e096cad281f7d74df05127","modified":1566989305200},{"_id":"themes/archer/layout/about.ejs","hash":"06019d835c0a51fed8aa086d1dfcf368f9921b42","modified":1566989305204},{"_id":"themes/archer/layout/index.ejs","hash":"716ba4a30860e36077dfdfffa02c1cd60301d8a3","modified":1566989305204},{"_id":"themes/archer/layout/layout.ejs","hash":"08ebd10c1b2bfc11be8f5115a836a98e6c6ba13c","modified":1566989305204},{"_id":"themes/archer/layout/post.ejs","hash":"b61156aff41641a14d5e4e45d9fd776309f2801a","modified":1566989305204},{"_id":"themes/archer/layout/site-meta.ejs","hash":"d866aa1a892d4bfe3368f6dbd0f1baa8c5831947","modified":1566989305205},{"_id":"themes/archer/source/.DS_Store","hash":"930c6508268f48a80018d8abc30d3bec638b3a99","modified":1566994101548},{"_id":"source/images/weekend.jpeg","hash":"e27bd6ad7cabf0957104cc143c209e8fdef5c428","modified":1567306494349},{"_id":"themes/archer/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1566989299706},{"_id":"themes/archer/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1566989299705},{"_id":"themes/archer/.git/hooks/fsmonitor-watchman.sample","hash":"f7c0aa40cb0d620ff0bca3efe3521ec79e5d7156","modified":1566989299706},{"_id":"themes/archer/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1566989299707},{"_id":"themes/archer/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1566989299708},{"_id":"themes/archer/.git/hooks/pre-commit.sample","hash":"33729ad4ce51acda35094e581e4088f3167a0af8","modified":1566989299705},{"_id":"themes/archer/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1566989299708},{"_id":"themes/archer/.git/hooks/pre-rebase.sample","hash":"288efdc0027db4cfd8b7c47c4aeddba09b6ded12","modified":1566989299705},{"_id":"themes/archer/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1566989299707},{"_id":"themes/archer/.git/hooks/prepare-commit-msg.sample","hash":"2584806ba147152ae005cb675aa4f01d5d068456","modified":1566989299707},{"_id":"themes/archer/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1566989299708},{"_id":"themes/archer/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1566989299704},{"_id":"themes/archer/.git/logs/HEAD","hash":"f525cd363c2de272b7c40c4052ae92ad55e714db","modified":1567158111365},{"_id":"themes/archer/.github/ISSUE_TEMPLATE/-----------bug--help-wanted-or-bug-report-.md","hash":"012bd3afea5565204f75d8c89048ad33b9c2f948","modified":1566989305195},{"_id":"themes/archer/.github/ISSUE_TEMPLATE/-----feature-request-.md","hash":"886fb1252702d46c89536b579d35ce49e53ec54d","modified":1566989305196},{"_id":"themes/archer/.github/ISSUE_TEMPLATE/-----other-issue-.md","hash":"4bf3c8ebef14a81bb55e8e0468d816e83c4133ac","modified":1566989305196},{"_id":"themes/archer/layout/_partial/algolia.ejs","hash":"2f5f9073378f628a9124792b5301c1540bc5a264","modified":1566989305200},{"_id":"themes/archer/layout/_partial/base-background-image.ejs","hash":"82203d9a1c6e16ef2d37b8b587f56bf6d16edaf2","modified":1566989305200},{"_id":"themes/archer/layout/_partial/base-footer.ejs","hash":"7bfb8af21f7d30780d1a3af5484760b07b4fbb1d","modified":1566989305200},{"_id":"themes/archer/layout/_partial/base-head.ejs","hash":"f2e8d4dfd11d879491a4b10f74f8c886cd392240","modified":1566989305200},{"_id":"themes/archer/layout/_partial/base-header.ejs","hash":"12e28693dc53cab5f6fd389f15ea0f811c9c37e9","modified":1566989305200},{"_id":"themes/archer/layout/_partial/base-preload-polyfill.ejs","hash":"2aea84cb43f4479131620b3c3dfd7cebe9be36ba","modified":1566989305200},{"_id":"themes/archer/layout/_partial/base-profile.ejs","hash":"c5b34e7edd135f0c3970cd746263ed1679f41af4","modified":1567059592519},{"_id":"themes/archer/layout/_partial/base-social.ejs","hash":"2d068432031b3bebf9438c775370a2d1b4492d6b","modified":1566989305201},{"_id":"themes/archer/layout/_partial/base-title-tags.ejs","hash":"418559ab11726f69621c3a58cd21903adff1e48e","modified":1566989305201},{"_id":"themes/archer/layout/_partial/intro-height.ejs","hash":"cd0d34a811dc4666980d57c00d70dd82bd5450eb","modified":1566989305202},{"_id":"themes/archer/source/assets/algolia_logo.svg","hash":"90035272fa31a3f65b3c0e2cb8a633876ef457dc","modified":1566989305208},{"_id":"themes/archer/source/assets/favicon.ico","hash":"f46fc2c74d1eca053022ce404ea79ee7b0ffb7af","modified":1567155394087},{"_id":"themes/archer/source/assets/loading.svg","hash":"45be17d07697d604d8981890eb21e308530c7a38","modified":1566989305208},{"_id":"themes/archer/source/assets/qr.png","hash":"cfe2c27eeee47b5b25072167b19b56dd5f0134f3","modified":1566991188244},{"_id":"themes/archer/source/avatar/logo.jpg","hash":"38450b286f7ec1a526fec5e557f58106e127eec9","modified":1567155568021},{"_id":"themes/archer/source/css/mobile.css","hash":"51d7b5cf26c8f82a3daad4bc55518673fdf281f5","modified":1566989305209},{"_id":"themes/archer/source/css/style.css","hash":"5d5e869db0c62957d59c6865baaecd1428c51804","modified":1566989305209},{"_id":"themes/archer/source/font/Source Sans Pro.woff","hash":"a6722c9b6439b7a020a9be3d3178970757a9265c","modified":1566989305211},{"_id":"themes/archer/source/font/Source Sans Pro.woff2","hash":"da65f527a8da65d5eb6721626d28cfdb46ab104a","modified":1566989305211},{"_id":"themes/archer/source/intro/.DS_Store","hash":"f2e2b1d02471a3df83adf04897c9afdb9b1d49b5","modified":1566994101546},{"_id":"themes/archer/source/lib/webfontloader.min.js","hash":"bc6ffe9c0d8b3285564619a445c6ca575eb9d0f5","modified":1566989305221},{"_id":"themes/archer/source/scripts/search.js","hash":"d5f739e261e8ce74f993c6157b248663bda122bf","modified":1566989305222},{"_id":"themes/archer/source/scripts/main.js","hash":"e89a9651131684204118fa74bd19cb781d76a372","modified":1566989305221},{"_id":"themes/archer/source/scripts/share.js","hash":"bb5bb37ce7f47f8c084b232df3e5fe2378d7ca01","modified":1566989305223},{"_id":"themes/archer/src/js/browser.js","hash":"ce061db99db5b880db0ddb768246352ca885b13c","modified":1566989305224},{"_id":"themes/archer/src/js/fancybox.js","hash":"0daf0e83deca055102268e3bd95cb1962acc2264","modified":1566989305225},{"_id":"themes/archer/src/js/init.js","hash":"346c6ef75ae85e4350c1b0811985172fdaa0d3a5","modified":1566989305225},{"_id":"themes/archer/src/js/initSidebar.js","hash":"b25615ff254913db83e2a20263d445f35083843b","modified":1566989305225},{"_id":"themes/archer/src/js/main.js","hash":"e1a48d5822326792e38d44efee86e01473549eba","modified":1566989305226},{"_id":"themes/archer/src/js/mobile.js","hash":"228a68d851517b5e47d2132f1d499cb812a64171","modified":1566989305226},{"_id":"themes/archer/src/js/scroll.js","hash":"aa2315a80daaa183a7e462c7e879ff9d2f050933","modified":1566989305226},{"_id":"themes/archer/src/js/search.js","hash":"2e59ac745da7c22801d9029cf9904a4fc3c384f1","modified":1566989305227},{"_id":"themes/archer/src/js/share.js","hash":"1314b19a852e291e35d6809f7f58652d3e7c524c","modified":1566989305227},{"_id":"themes/archer/src/js/sidebar.js","hash":"68d5fe0ee5e86df810d304e5efe11e5e1fddc46d","modified":1566989305227},{"_id":"themes/archer/src/js/tag.js","hash":"e0f0a914c02922e42977d78dc4993b3855167cd8","modified":1566989305228},{"_id":"themes/archer/src/js/toc.js","hash":"b3482031e4c8728535d480bfaec76229469e3aba","modified":1566989305228},{"_id":"themes/archer/src/js/util.js","hash":"27de6446892bcf399430dd5776df0b8759ca0eea","modified":1566989305228},{"_id":"themes/archer/src/scss/_common.scss","hash":"dedc313b082e0a16daf87213badd21b13be11af8","modified":1566989305228},{"_id":"themes/archer/src/scss/_mixin.scss","hash":"e7deb20a16868ae9d3e35ba3c5693de71fdf6999","modified":1566989305229},{"_id":"themes/archer/src/scss/_normalize.scss","hash":"a2dbeb38ad08bb8975856d75954cc697bf8e5ff7","modified":1566989305229},{"_id":"themes/archer/src/scss/_variables.scss","hash":"136e5d990c4f8eadf6cabdfa5a053941e90bcd20","modified":1566989305235},{"_id":"themes/archer/src/scss/mobile.scss","hash":"aadc2fbf37fefc2ad391d8172d5b61817f9db0c5","modified":1566989305235},{"_id":"themes/archer/src/scss/style.scss","hash":"78e31370d45089b97fa91929345f1a29f2e6a0a2","modified":1566989305235},{"_id":"source/images/travis.png","hash":"52333b84a76abf24152585bf0045b279ef3e0f35","modified":1567337141690},{"_id":"themes/archer/package-lock.json","hash":"89a3b67d32f6916cdc21d590d87e43d8a44be8c3","modified":1566989305207},{"_id":"themes/archer/layout/_partial/comment/custom.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1566989305201},{"_id":"themes/archer/source/font/Oswald-Regular.ttf","hash":"965d729546a43a8490ad4cf33c25ac475682100c","modified":1566989305211},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff","hash":"12eef75e1ad3eca9dae42b65505010ce4464a315","modified":1566989305212},{"_id":"themes/archer/source/font/SourceCodePro-Regular.ttf.woff2","hash":"f5991289ec17884cb641da0646d278d36702a190","modified":1566989305213},{"_id":"themes/archer/source/intro/404-bg.jpg","hash":"3afb5bb26f4ff0bd0e0a28df955c8aa7d746d3c5","modified":1566989305214},{"_id":"themes/archer/source/lib/jquery.min.js","hash":"0dc32db4aa9c5f03f3b38c47d883dbd4fed13aae","modified":1566989305220},{"_id":"themes/archer/.git/objects/48/e11995448299068196b3c43a38d0fa8a23c3be","hash":"e1289b38ff89dffbe7956f825ebd343f1495a388","modified":1567158111360},{"_id":"themes/archer/.git/objects/14/6973320c512ffacc1cf74e80d7be0fef2ce320","hash":"6d17bc5f829fd4ca936099ab91ff645dcfcc35fa","modified":1567158111361},{"_id":"themes/archer/.git/objects/02/aef233aa8e59c3f67689444a334e0217d962b7","hash":"ebf7b931e65b814ed57a62eff4c4f9cdf078d945","modified":1567158111359},{"_id":"themes/archer/.git/objects/38/17fea9132391f99b2b9345563655474081d1db","hash":"4bb7311fda28d733a2359c1b2705d33feaa55cbe","modified":1567158064131},{"_id":"themes/archer/.git/objects/4f/580f2209f1457c90d5b1e52620b4c1cd337a43","hash":"ecef4505170ed353f7d181a6ac32df0324b18139","modified":1567158111360},{"_id":"themes/archer/.git/objects/8e/d1923aeadac050f439fbca00c7d2d346c9a961","hash":"900ae2e703b45435753002e68465c205a66baeb5","modified":1567158064131},{"_id":"themes/archer/.git/objects/c1/10b8d9bac1997af1d35b82866666f27a23d091","hash":"c9ad5ac30f7f27afd4f4b6d921ec308c82e66c0c","modified":1567158111363},{"_id":"themes/archer/.git/objects/e1/8cf44fbb88e9d9cefa9bbf6aca49a6c7c5517a","hash":"424e22451f7d7b737bacc93d5ddc4ef475332bea","modified":1567158111358},{"_id":"themes/archer/.git/objects/b2/75dae2073d8148c1a25fbfc452ae9b1d5f2d9a","hash":"d1d7f9f96b8f93a556e7f89233f4bcbe76a4960a","modified":1567158064129},{"_id":"themes/archer/.git/objects/ec/9a0b0ca583ee7b14ef2fdbe2d4668e35a83ed8","hash":"aee3ec2dc54a00b8f60628b1df551544307eb8fc","modified":1567158064142},{"_id":"themes/archer/.git/objects/f2/3bb239b235920d34d171cf75a039db99a24bbb","hash":"70441b50226cc76860063566d62fdef049a856ec","modified":1567158111359},{"_id":"themes/archer/.git/objects/f3/1c90130f49ed5d940a7e161868b323a9c163b5","hash":"fa7360ce8b73e5b21fc3a98ab9d0552d182014c5","modified":1567158111358},{"_id":"themes/archer/.git/objects/f6/8e5d1cfb273b582d41590ece6f4112b95c2d09","hash":"34da65fbbf0d3eb744cac3c134f2d9973682dc95","modified":1567158111361},{"_id":"themes/archer/.git/objects/f9/bd26c90661c20a0552d6a2212bee7c50a0f251","hash":"b4c27556a7183771bcae5e95302429c29cc90c82","modified":1567158064130},{"_id":"themes/archer/.git/objects/pack/pack-f8fed2b1bba0dfab15feba1aa870dcde1da07f8d.idx","hash":"a3e667f45a19c1286054989a30db17c2d7e980ff","modified":1566989305178},{"_id":"themes/archer/.git/refs/heads/master","hash":"b0c2e48621ce088c1d957a725a3f9efdeeaa6d2a","modified":1567158111365},{"_id":"themes/archer/.git/objects/e2/de0d25b3490518b1b6178b4c4beee4411a13f8","hash":"1fb0f4ffa699c5d621bc73d9afb15bb801006588","modified":1567158064134},{"_id":"themes/archer/layout/_partial/comment/changyan.ejs","hash":"7691642fb9375607e0ac988a7420999e242cb2c9","modified":1566989305201},{"_id":"themes/archer/layout/_partial/comment/disqus.ejs","hash":"cadd97820a23d01d8b7e2f19a86e5290cef5a8a6","modified":1566989305201},{"_id":"themes/archer/layout/_partial/comment/gitment.ejs","hash":"794647a8a4ac9e1d01d74c07717175a141b1e01c","modified":1566989305201},{"_id":"themes/archer/layout/_partial/comment/livere.ejs","hash":"b27469f19f35ec2037c7bce736a12e9dfb5e360b","modified":1566989305202},{"_id":"themes/archer/layout/_partial/comment/valine.ejs","hash":"2154360e330dab94540e168e9d301c7b7091968e","modified":1566989305202},{"_id":"themes/archer/layout/_partial/comment/youyan.ejs","hash":"790d76f2667377db78a7d04bad8d629e47e7aab0","modified":1566989305202},{"_id":"themes/archer/layout/_partial/critical-css/critical-style.ejs","hash":"bbad4bf73858f50e99eb678d966cd6ee1d534408","modified":1566992802836},{"_id":"themes/archer/layout/_partial/script/font-loader.ejs","hash":"291cc0a4a444a93b93c32e2c39383c70e36e46de","modified":1566989305202},{"_id":"themes/archer/layout/_partial/sidebar/base-sidebar.ejs","hash":"2d38af7cb5aabc0af99de239bd180c516ec4c56c","modified":1566989305203},{"_id":"themes/archer/layout/_partial/sidebar/sidebar-archives.ejs","hash":"daa78b17a773bca569f1c8ca2c916495ca138da6","modified":1566989305203},{"_id":"themes/archer/layout/_partial/sidebar/sidebar-categories.ejs","hash":"147214469c4909eb94943599883f9fa0f3cc090d","modified":1566989305203},{"_id":"themes/archer/layout/_partial/sidebar/sidebar-tags.ejs","hash":"d6e1a192cac5dcf365ce1a52df4f23feafeeb849","modified":1566989305203},{"_id":"themes/archer/source/avatar/avtar.jpg","hash":"8d693792ba6e95b9eeefcfd62cb30e4ad91af519","modified":1566993846251},{"_id":"themes/archer/src/scss/_partial/_404.scss","hash":"a2b56f441a9a44d7f5b9b41eaa8136321328d7e9","modified":1566989305229},{"_id":"themes/archer/src/scss/_partial/_algolia.scss","hash":"c679578d2feb0bd7d3f80c2f693ba58cbca4428b","modified":1566989305230},{"_id":"themes/archer/src/scss/_partial/_index-page.scss","hash":"fa993cf0bbe0086cd8ec3d9a639b2d5b28ccfa8e","modified":1566989305230},{"_id":"themes/archer/src/scss/_partial/_post-page.scss","hash":"7c557844850d53cc4fc36aaf6d59847d8f238947","modified":1566989305232},{"_id":"themes/archer/docs/snap.png","hash":"0b2a8bf016f6eed576abfdcdb7dcf8de51c12562","modified":1566989305199},{"_id":"themes/archer/source/intro/about-bg.jpg","hash":"ab388276822417cc4e703312c14e20280ec783b3","modified":1566989305216},{"_id":"themes/archer/source/intro/bg.jpg","hash":"f028bd23507f9ef5d3aa2aec1913fccfa4e674d9","modified":1566993760559},{"_id":"themes/archer/source/intro/post-bg.jpg","hash":"525fafb2238c27754d8fa751f143ff1de9b8482d","modified":1566989305220},{"_id":"themes/archer/.git/logs/refs/heads/master","hash":"f525cd363c2de272b7c40c4052ae92ad55e714db","modified":1567158111365},{"_id":"themes/archer/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1566989305188},{"_id":"themes/archer/.git/objects/38/4182e31e66d548164f1ea9e787429c652dac73","hash":"23b126d122984fc02a4dd7d5b5b02e916f7a3953","modified":1567158064141},{"_id":"themes/archer/src/scss/_partial/_partial/_footer.scss","hash":"726c543ee066e0b3222b236d9b4ef0109c0bdddf","modified":1566989305230},{"_id":"themes/archer/src/scss/_partial/_partial/_header.scss","hash":"77003ff22b1a10fae2d2768938277959b3f93a72","modified":1566989305230},{"_id":"themes/archer/src/scss/_partial/_partial/_intro.scss","hash":"a1569f39eccd64a12425d81b794c53df126a4d87","modified":1566989305231},{"_id":"themes/archer/src/scss/_partial/_partial/_paginator.scss","hash":"67c2e697a5fbb3b8006cf358ea45eb7f75b496f8","modified":1566989305231},{"_id":"themes/archer/src/scss/_partial/_partial/_profile.scss","hash":"0c986b52ce9083f08c37c5c9b5de045ac5e1d2fa","modified":1566989305231},{"_id":"themes/archer/src/scss/_partial/_partial/_scrollbar.scss","hash":"f2514031f9d7e4ed4a126694e78618ce6ff3a574","modified":1566989305232},{"_id":"themes/archer/src/scss/_partial/_post/_code.scss","hash":"9c9a4e470da8732c9a3be3d5ce0d2f80f53714fe","modified":1566989305233},{"_id":"themes/archer/src/scss/_partial/_sidebar/_sidebar-archive.scss","hash":"14bc42292873880c61b5fa9f47ee9d2e08d46871","modified":1566989305233},{"_id":"themes/archer/src/scss/_partial/_sidebar/_sidebar-tags.scss","hash":"9ab6f96d0df0c4ad4c72e2515fa2599d487d8f1a","modified":1566989305234},{"_id":"themes/archer/src/scss/_partial/_sidebar/_sidebar.scss","hash":"981a94978535769cb51c29e12b627f83c6fcedc5","modified":1566989305234},{"_id":"themes/archer/.git/objects/0e/15cac5122ac0b56836cd76ef1bdb42741c1dfd","hash":"3d9740d34ef505251783186ba0acc8f2b6c0b339","modified":1567158064154},{"_id":"themes/archer/source/intro/index-bg.jpg","hash":"96b52e177b8bc53e64ec6ee1e10b2b6a4e13083b","modified":1566989305218},{"_id":"themes/archer/.git/logs/refs/remotes/origin/HEAD","hash":"ba5425c59a0e72f80beb3c341993fb81971c8d30","modified":1566989305188},{"_id":"themes/archer/.git/objects/pack/pack-f8fed2b1bba0dfab15feba1aa870dcde1da07f8d.pack","hash":"eaa1f47afcb757f87db409ea10cfd12cb8d9f59f","modified":1566989305178},{"_id":"source/images/iv.png","hash":"06614226fd14f6f18c96133bfff6d3a4663c6f5f","modified":1567341098856},{"_id":"source/images/encrypt.png","hash":"fd22fcba73ccc1eadade3e1323e4a240beea8913","modified":1567340650980},{"_id":"source/images/login.png","hash":"c2813d57bd6a01800858baf8ee561f5b366f3837","modified":1567340645957}],"Category":[],"Data":[],"Page":[{"title":"tags","date":"2019-08-27T13:13:30.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2019-08-27 21:13:30\ntype: \"tags\"\n---\n","updated":"2019-08-27T13:14:38.021Z","path":"tags/index.html","comments":1,"layout":"page","_id":"ck00w6z1h0001ocoxyp1z860t","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"I'm Cooper","date":"2019-08-29T06:58:14.000Z","layout":"about","_content":"\n> 在我一生的黄金时代，我有好多奢望。\n> 我想爱，想吃，还想在一瞬间变成天上半明半暗的云。\n> 后来我才知道，生活就是个缓慢受锤的过程。\n> 人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。\n> 我希望自己会永远生猛下去，什么也锤不了我。 \n\n## 靓仔\n<img src=\"https://github.com/huguobo/public/blob/master/avtar.jpg?raw=true\" width=\"25%\" style=\"margin: 0\">\n\n## 基本信息\n- 男\n- 性格开朗\n- 1992 年生人\n\n## 学习生涯\n- 吉林大学\n- 软件工程\n- 硕士\n\n## 职业信息\n- 前端工程师(全干工程师)\n\n### 工作经历\n- 2017.7 ~ 2019.7 [美团点评](https://about.meituan.com/home) \n- 2019.8 ~ 至今 [腾讯科技](https://www.tencent.com/zh-cn/index.html)\n\n### 技能（别问，问就是‘熟悉’）\n- Javascript、Css 和 HTML 基础3件套\n- 基于 React、Vue 等的流行前端框架\n- webpack、gulp 等前端工程化工具\n- 前端 CI/CD 流程，基础 devOps\n- Node\n- Koa、Express 等 node 前端框架\n- Mysql curd\n- git、shell、nginx 等基础工具\n\n## 状态\n- 在职\n- 身体还算健康\n- 心理非常健康\n- 价值观很正\n\n## 爱好\n- 主机游戏\n- 旅行\n- 🏀\n- 发呆\n\n## 其他\n- 小语种学习中\n\n","source":"about/index.md","raw":"---\ntitle: I'm Cooper\ndate: 2019-08-29 14:58:14\nlayout: about\n---\n\n> 在我一生的黄金时代，我有好多奢望。\n> 我想爱，想吃，还想在一瞬间变成天上半明半暗的云。\n> 后来我才知道，生活就是个缓慢受锤的过程。\n> 人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。\n> 我希望自己会永远生猛下去，什么也锤不了我。 \n\n## 靓仔\n<img src=\"https://github.com/huguobo/public/blob/master/avtar.jpg?raw=true\" width=\"25%\" style=\"margin: 0\">\n\n## 基本信息\n- 男\n- 性格开朗\n- 1992 年生人\n\n## 学习生涯\n- 吉林大学\n- 软件工程\n- 硕士\n\n## 职业信息\n- 前端工程师(全干工程师)\n\n### 工作经历\n- 2017.7 ~ 2019.7 [美团点评](https://about.meituan.com/home) \n- 2019.8 ~ 至今 [腾讯科技](https://www.tencent.com/zh-cn/index.html)\n\n### 技能（别问，问就是‘熟悉’）\n- Javascript、Css 和 HTML 基础3件套\n- 基于 React、Vue 等的流行前端框架\n- webpack、gulp 等前端工程化工具\n- 前端 CI/CD 流程，基础 devOps\n- Node\n- Koa、Express 等 node 前端框架\n- Mysql curd\n- git、shell、nginx 等基础工具\n\n## 状态\n- 在职\n- 身体还算健康\n- 心理非常健康\n- 价值观很正\n\n## 爱好\n- 主机游戏\n- 旅行\n- 🏀\n- 发呆\n\n## 其他\n- 小语种学习中\n\n","updated":"2019-08-30T10:04:12.263Z","path":"about/index.html","comments":1,"_id":"ck00w6z1j0003ocoxh1ceh3w3","content":"<blockquote>\n<p>在我一生的黄金时代，我有好多奢望。<br>我想爱，想吃，还想在一瞬间变成天上半明半暗的云。<br>后来我才知道，生活就是个缓慢受锤的过程。<br>人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。<br>我希望自己会永远生猛下去，什么也锤不了我。 </p>\n</blockquote>\n<h2 id=\"靓仔\"><a href=\"#靓仔\" class=\"headerlink\" title=\"靓仔\"></a>靓仔</h2><img src=\"https://github.com/huguobo/public/blob/master/avtar.jpg?raw=true\" width=\"25%\" style=\"margin: 0\">\n\n<h2 id=\"基本信息\"><a href=\"#基本信息\" class=\"headerlink\" title=\"基本信息\"></a>基本信息</h2><ul>\n<li>男</li>\n<li>性格开朗</li>\n<li>1992 年生人</li>\n</ul>\n<h2 id=\"学习生涯\"><a href=\"#学习生涯\" class=\"headerlink\" title=\"学习生涯\"></a>学习生涯</h2><ul>\n<li>吉林大学</li>\n<li>软件工程</li>\n<li>硕士</li>\n</ul>\n<h2 id=\"职业信息\"><a href=\"#职业信息\" class=\"headerlink\" title=\"职业信息\"></a>职业信息</h2><ul>\n<li>前端工程师(全干工程师)</li>\n</ul>\n<h3 id=\"工作经历\"><a href=\"#工作经历\" class=\"headerlink\" title=\"工作经历\"></a>工作经历</h3><ul>\n<li>2017.7 ~ 2019.7 <a href=\"https://about.meituan.com/home\" target=\"_blank\" rel=\"noopener\">美团点评</a> </li>\n<li>2019.8 ~ 至今 <a href=\"https://www.tencent.com/zh-cn/index.html\" target=\"_blank\" rel=\"noopener\">腾讯科技</a></li>\n</ul>\n<h3 id=\"技能（别问，问就是‘熟悉’）\"><a href=\"#技能（别问，问就是‘熟悉’）\" class=\"headerlink\" title=\"技能（别问，问就是‘熟悉’）\"></a>技能（别问，问就是‘熟悉’）</h3><ul>\n<li>Javascript、Css 和 HTML 基础3件套</li>\n<li>基于 React、Vue 等的流行前端框架</li>\n<li>webpack、gulp 等前端工程化工具</li>\n<li>前端 CI/CD 流程，基础 devOps</li>\n<li>Node</li>\n<li>Koa、Express 等 node 前端框架</li>\n<li>Mysql curd</li>\n<li>git、shell、nginx 等基础工具</li>\n</ul>\n<h2 id=\"状态\"><a href=\"#状态\" class=\"headerlink\" title=\"状态\"></a>状态</h2><ul>\n<li>在职</li>\n<li>身体还算健康</li>\n<li>心理非常健康</li>\n<li>价值观很正</li>\n</ul>\n<h2 id=\"爱好\"><a href=\"#爱好\" class=\"headerlink\" title=\"爱好\"></a>爱好</h2><ul>\n<li>主机游戏</li>\n<li>旅行</li>\n<li>🏀</li>\n<li>发呆</li>\n</ul>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><ul>\n<li>小语种学习中</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>在我一生的黄金时代，我有好多奢望。<br>我想爱，想吃，还想在一瞬间变成天上半明半暗的云。<br>后来我才知道，生活就是个缓慢受锤的过程。<br>人一天天老下去，奢望也一天天消失，最后变得像挨了锤的牛一样。<br>我希望自己会永远生猛下去，什么也锤不了我。 </p>\n</blockquote>\n<h2 id=\"靓仔\"><a href=\"#靓仔\" class=\"headerlink\" title=\"靓仔\"></a>靓仔</h2><img src=\"https://github.com/huguobo/public/blob/master/avtar.jpg?raw=true\" width=\"25%\" style=\"margin: 0\">\n\n<h2 id=\"基本信息\"><a href=\"#基本信息\" class=\"headerlink\" title=\"基本信息\"></a>基本信息</h2><ul>\n<li>男</li>\n<li>性格开朗</li>\n<li>1992 年生人</li>\n</ul>\n<h2 id=\"学习生涯\"><a href=\"#学习生涯\" class=\"headerlink\" title=\"学习生涯\"></a>学习生涯</h2><ul>\n<li>吉林大学</li>\n<li>软件工程</li>\n<li>硕士</li>\n</ul>\n<h2 id=\"职业信息\"><a href=\"#职业信息\" class=\"headerlink\" title=\"职业信息\"></a>职业信息</h2><ul>\n<li>前端工程师(全干工程师)</li>\n</ul>\n<h3 id=\"工作经历\"><a href=\"#工作经历\" class=\"headerlink\" title=\"工作经历\"></a>工作经历</h3><ul>\n<li>2017.7 ~ 2019.7 <a href=\"https://about.meituan.com/home\" target=\"_blank\" rel=\"noopener\">美团点评</a> </li>\n<li>2019.8 ~ 至今 <a href=\"https://www.tencent.com/zh-cn/index.html\" target=\"_blank\" rel=\"noopener\">腾讯科技</a></li>\n</ul>\n<h3 id=\"技能（别问，问就是‘熟悉’）\"><a href=\"#技能（别问，问就是‘熟悉’）\" class=\"headerlink\" title=\"技能（别问，问就是‘熟悉’）\"></a>技能（别问，问就是‘熟悉’）</h3><ul>\n<li>Javascript、Css 和 HTML 基础3件套</li>\n<li>基于 React、Vue 等的流行前端框架</li>\n<li>webpack、gulp 等前端工程化工具</li>\n<li>前端 CI/CD 流程，基础 devOps</li>\n<li>Node</li>\n<li>Koa、Express 等 node 前端框架</li>\n<li>Mysql curd</li>\n<li>git、shell、nginx 等基础工具</li>\n</ul>\n<h2 id=\"状态\"><a href=\"#状态\" class=\"headerlink\" title=\"状态\"></a>状态</h2><ul>\n<li>在职</li>\n<li>身体还算健康</li>\n<li>心理非常健康</li>\n<li>价值观很正</li>\n</ul>\n<h2 id=\"爱好\"><a href=\"#爱好\" class=\"headerlink\" title=\"爱好\"></a>爱好</h2><ul>\n<li>主机游戏</li>\n<li>旅行</li>\n<li>🏀</li>\n<li>发呆</li>\n</ul>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><ul>\n<li>小语种学习中</li>\n</ul>\n"}],"Post":[{"title":"Travis-CI 持续集成 hexo 到云服务器","date":"2019-09-01T10:35:40.000Z","_content":"\n> 烦：每次本地提交代码到 GitHub 上后还要自己手动同步文件到云服务器，完成所谓的部署工作有点麻烦和脱节。\n> 懒：程序员等所有自称工程师进步的先决动力，想实现一个我每次提交代码后，后面的构建，打包和部署都自动进行的流程。\n> 因为本身代码托管在 Github 上，所以就开始折腾 Travis-CI了。\n\n\n## 什么是CI\n持续集成服务（Continuous Integration，简称 CI）。\n一般指的是提供一个运行环境，自动化执行单元测试，规范检查，基于环境的构建，服务部署等流水线作业。\n持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。\n另外，这个是工程化实践，如果你觉得自己手动操作比整这些繁琐的流程方便多了，我觉得也是没问题的。\n\n## Travis CI \n[Travis CI](https://travis-ci.com/) 对 Github 上的开源项目提供免费服务，这要求必须有 Github 账号。界面也很赞~，让我想起了前东家的 PLUS 发布系统。 \n![travis](/images/travis.png)\n可以使用 github 账号直接登录， public 的仓库也直接同步到 Travis 上了， 选择想开启 Travis CI 的仓库，打开开关即可。详细配置不细说了，图形化界面，进去就知道了。\n\n### .travis.yml\nTravis-CI配置文件，存放在项目根目录下。\n支持多种语言，在配置文件中 `language: node_js`\n一个比较完整的生命周期\n\n```bash\nbefore_install\ninstall\nbefore_script\nscript\naftersuccess or afterfailure\n[OPTIONAL] before_deploy\n[OPTIONAL] deploy\n[OPTIONAL] after_deploy\nafter_script\n```\n详细配置参考 [官方文档](https://docs.travis-ci.com)\n\n## 一些准备工作\n由于后面的免密登录和部署流程会涉及一些环境和配置类的操作，这个部分介绍下前置条件。\n\n### SCP命令\nscp 命令用于linux下的跨主机之间的文件和目录复制\n在首次连接服务器时，会弹出公钥确认的提示。这会导致某些自动化任务，由于初次连接服务器而导致自动化任务中断，\n可在 StrictHostKeyChecking选项，用 -o 参数指定后，则不检查该项。\n\n```bash\nscp [可选参数] file_source file_target\n#将public目录下的所有文件复制到$DEPLOY_IP下的/path/to/blog目录中。不检查key，\nscp -o StrictHostKeyChecking=no -r public/*  user@$DEPLOY_IP:/path/to/blog/\n#可用-i指定私钥。\nscp -o  StrictHostKeyChecking=no -i .ssh/id_rsa yourfile user@destinate_ip:/dest_folder\n#或将自己的公钥放到目标机的authorized_keys文件里，使自己为目标机的信任机器，实现无密码登录\n#这个是在生成ssh key 后，将公钥放到authorized_keys文件中。使用密钥对可以实现不输入密码\ncd ~/.ssh\ncat id_rsa.pub >> authorized_keys\n```\n### centOS使用gem\n因为后面要使用 `gem install travis` ,所以可能会需要 升级 ruby 和 切换 gem 源（亲测 ruby 版本低会安装报错，gem 用官方源真的是动都不动啊，太难了）\n\n\n#### 切换gem源\n```bash\n$ gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/\n$ gem sources -l\nhttps://gems.ruby-china.com\n# 确保只有 gems.ruby-china.com\n$ gem update --system \n$ gem -v\n2.6.3\n```\n#### 升级Ruby\n安装[RAM](https://rvm.io/), 一款ruby版本管理工具，类似 node 的 nvm。\n```bash\ngpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB\ncurl -sSL https://get.rvm.io | bash -s stable\nsource /etc/profile.d/rvm.sh\nrvm -v\n```\n\n安装新版 ruby\n```bash\nrvm install 2.6\n```\n\n## 自动部署到远程服务器\n对于项目的构建来说都是 执行配置文件中写好的脚本，这个项目可能 就是 `npm install && hexo clean && hexo g`, 那么怎么执行最后一步，把文件同步传输到 云服务器上呢。 我们使用CI就是手动过程太繁琐，重复没有意义，怎么实现 `免密` 部署呢。\n\n登录到 `云服务器(centOS 7.x)`,进行如下操作\n### 生成 ssh key\n```bash\ncd ~/.ssh\n# create ssh key\nssh-keygen -t rsa -b 4096 -C \"TravisCIDeployKey\"  #一直回车\n\nls\n# 可以看到.ssh目录下得到了两个文件：id_rsa（私有秘钥）和id_rsa.pub（公有密钥）\n#id_rsa  id_rsa.pub\n\n#append the public key to the list of \"authorized keys\":\ncat id_rsa.pub >> authorized_keys\n```\n### 下载 travis 输出对应加密的私钥到 travis \n为了达到免密登录的效果，势必要用到ssh登录，肯定要告诉 travis 我们远程服务器的用户名密码，但是直接给明文不太好， travis 提供了加密功能。\n```bash\ngem install travis #  这步失败的话请看上面关于升级ruby和切换gem源的部分\ntravis login\n```\n\n登录 github 账号密码，这个安全直接连接的 github 服务\n![login](/images/login.png)\n\n加密私钥，生成.travis.yml \n```bash\ntouch .travis.yml && travis encrypt-file ~/.ssh/id_rsa --add -r huguobo/hexo-blog\ncat .travis.yml  \n### .travis.yml  内容\nbefore_install:\n- openssl aes-256-cbc -K $encrypted_77965d5bdd4d_key -iv $encrypted_77965d5bdd4d_iv\n  -in id_rsa.enc -out ./id_rsa -d \n```\n\n.travis.yml 的内容复制到你项目里的 .travis.yml 内，为保证权限正常，多加一行设置权限的 shell\n```bash\nbefore_install:\n  - openssl aes-256-cbc -K $encrypted_d89376f3278d_key -iv $encrypted_d89376f3278d_iv\n    -in id_rsa.enc -out ~/.ssh/id_rsa -d\n  - chmod 600 ~/.ssh/id_rsa\n```\n\n$encrypted_77965d5bdd4d_key 和 $encrypted_77965d5bdd4d_iv 是travis 帮忙生成的环境变量，已经同步到 huguobo/hexo-blog 这个项目上了。\n![iv](/images/iv.png)\n\n还有一点可能会用上，因为 travis 第一次登录远程服务器会出现 SSH 主机验证，这边会有一个主机信任问题。官方给出的方案是添加 addons 配置\n```bash\naddons:\n  ssh_known_hosts: your-ip\n```\n\n项目根目录下的 `id_rsa.enc` 文件就是我们加密的私钥文件, 把它复制到我们  hexo 项目的根目录下就好啦~\n\n## 最终的 .travis.yml 配置\n\n```bash\nlanguage: node_js\n\nnode_js:\n  - \"10\"\n\ncache:\n  apt: true\n  directories:\n    - node_modules\n\nbefore_install:\n- openssl aes-256-cbc -K $encrypted_1fc90f464345_key -iv $encrypted_1fc90f464345_iv\n  -in id_rsa.enc -out ~\\/.ssh/id_rsa -d\n- chmod 600 ~/.ssh/id_rsa\n\naddons:\n  ssh_known_hosts: $DEPLOY_IP\n\nscript:\n  - hexo clean && hexo generate\n\nafter_success:\n  - pwd\n  - scp -o StrictHostKeyChecking=no -r public/*  root@$DEPLOY_IP:/opt/hexoBlog/\n\nbranches:\n  only:\n    - master\n\nnotifications:\n  email:\n    - huguobo2010@126.com\n  on_success: change\n  on_failure: always\n```","source":"_posts/Travis-CI持续集成Hexo到云服务器.md","raw":"---\ntitle: Travis-CI 持续集成 hexo 到云服务器\ndate: 2019-09-01 18:35:40\ntags:\n- travis\n- CI\n- hexo\n- blog\n---\n\n> 烦：每次本地提交代码到 GitHub 上后还要自己手动同步文件到云服务器，完成所谓的部署工作有点麻烦和脱节。\n> 懒：程序员等所有自称工程师进步的先决动力，想实现一个我每次提交代码后，后面的构建，打包和部署都自动进行的流程。\n> 因为本身代码托管在 Github 上，所以就开始折腾 Travis-CI了。\n\n\n## 什么是CI\n持续集成服务（Continuous Integration，简称 CI）。\n一般指的是提供一个运行环境，自动化执行单元测试，规范检查，基于环境的构建，服务部署等流水线作业。\n持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。\n另外，这个是工程化实践，如果你觉得自己手动操作比整这些繁琐的流程方便多了，我觉得也是没问题的。\n\n## Travis CI \n[Travis CI](https://travis-ci.com/) 对 Github 上的开源项目提供免费服务，这要求必须有 Github 账号。界面也很赞~，让我想起了前东家的 PLUS 发布系统。 \n![travis](/images/travis.png)\n可以使用 github 账号直接登录， public 的仓库也直接同步到 Travis 上了， 选择想开启 Travis CI 的仓库，打开开关即可。详细配置不细说了，图形化界面，进去就知道了。\n\n### .travis.yml\nTravis-CI配置文件，存放在项目根目录下。\n支持多种语言，在配置文件中 `language: node_js`\n一个比较完整的生命周期\n\n```bash\nbefore_install\ninstall\nbefore_script\nscript\naftersuccess or afterfailure\n[OPTIONAL] before_deploy\n[OPTIONAL] deploy\n[OPTIONAL] after_deploy\nafter_script\n```\n详细配置参考 [官方文档](https://docs.travis-ci.com)\n\n## 一些准备工作\n由于后面的免密登录和部署流程会涉及一些环境和配置类的操作，这个部分介绍下前置条件。\n\n### SCP命令\nscp 命令用于linux下的跨主机之间的文件和目录复制\n在首次连接服务器时，会弹出公钥确认的提示。这会导致某些自动化任务，由于初次连接服务器而导致自动化任务中断，\n可在 StrictHostKeyChecking选项，用 -o 参数指定后，则不检查该项。\n\n```bash\nscp [可选参数] file_source file_target\n#将public目录下的所有文件复制到$DEPLOY_IP下的/path/to/blog目录中。不检查key，\nscp -o StrictHostKeyChecking=no -r public/*  user@$DEPLOY_IP:/path/to/blog/\n#可用-i指定私钥。\nscp -o  StrictHostKeyChecking=no -i .ssh/id_rsa yourfile user@destinate_ip:/dest_folder\n#或将自己的公钥放到目标机的authorized_keys文件里，使自己为目标机的信任机器，实现无密码登录\n#这个是在生成ssh key 后，将公钥放到authorized_keys文件中。使用密钥对可以实现不输入密码\ncd ~/.ssh\ncat id_rsa.pub >> authorized_keys\n```\n### centOS使用gem\n因为后面要使用 `gem install travis` ,所以可能会需要 升级 ruby 和 切换 gem 源（亲测 ruby 版本低会安装报错，gem 用官方源真的是动都不动啊，太难了）\n\n\n#### 切换gem源\n```bash\n$ gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/\n$ gem sources -l\nhttps://gems.ruby-china.com\n# 确保只有 gems.ruby-china.com\n$ gem update --system \n$ gem -v\n2.6.3\n```\n#### 升级Ruby\n安装[RAM](https://rvm.io/), 一款ruby版本管理工具，类似 node 的 nvm。\n```bash\ngpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB\ncurl -sSL https://get.rvm.io | bash -s stable\nsource /etc/profile.d/rvm.sh\nrvm -v\n```\n\n安装新版 ruby\n```bash\nrvm install 2.6\n```\n\n## 自动部署到远程服务器\n对于项目的构建来说都是 执行配置文件中写好的脚本，这个项目可能 就是 `npm install && hexo clean && hexo g`, 那么怎么执行最后一步，把文件同步传输到 云服务器上呢。 我们使用CI就是手动过程太繁琐，重复没有意义，怎么实现 `免密` 部署呢。\n\n登录到 `云服务器(centOS 7.x)`,进行如下操作\n### 生成 ssh key\n```bash\ncd ~/.ssh\n# create ssh key\nssh-keygen -t rsa -b 4096 -C \"TravisCIDeployKey\"  #一直回车\n\nls\n# 可以看到.ssh目录下得到了两个文件：id_rsa（私有秘钥）和id_rsa.pub（公有密钥）\n#id_rsa  id_rsa.pub\n\n#append the public key to the list of \"authorized keys\":\ncat id_rsa.pub >> authorized_keys\n```\n### 下载 travis 输出对应加密的私钥到 travis \n为了达到免密登录的效果，势必要用到ssh登录，肯定要告诉 travis 我们远程服务器的用户名密码，但是直接给明文不太好， travis 提供了加密功能。\n```bash\ngem install travis #  这步失败的话请看上面关于升级ruby和切换gem源的部分\ntravis login\n```\n\n登录 github 账号密码，这个安全直接连接的 github 服务\n![login](/images/login.png)\n\n加密私钥，生成.travis.yml \n```bash\ntouch .travis.yml && travis encrypt-file ~/.ssh/id_rsa --add -r huguobo/hexo-blog\ncat .travis.yml  \n### .travis.yml  内容\nbefore_install:\n- openssl aes-256-cbc -K $encrypted_77965d5bdd4d_key -iv $encrypted_77965d5bdd4d_iv\n  -in id_rsa.enc -out ./id_rsa -d \n```\n\n.travis.yml 的内容复制到你项目里的 .travis.yml 内，为保证权限正常，多加一行设置权限的 shell\n```bash\nbefore_install:\n  - openssl aes-256-cbc -K $encrypted_d89376f3278d_key -iv $encrypted_d89376f3278d_iv\n    -in id_rsa.enc -out ~/.ssh/id_rsa -d\n  - chmod 600 ~/.ssh/id_rsa\n```\n\n$encrypted_77965d5bdd4d_key 和 $encrypted_77965d5bdd4d_iv 是travis 帮忙生成的环境变量，已经同步到 huguobo/hexo-blog 这个项目上了。\n![iv](/images/iv.png)\n\n还有一点可能会用上，因为 travis 第一次登录远程服务器会出现 SSH 主机验证，这边会有一个主机信任问题。官方给出的方案是添加 addons 配置\n```bash\naddons:\n  ssh_known_hosts: your-ip\n```\n\n项目根目录下的 `id_rsa.enc` 文件就是我们加密的私钥文件, 把它复制到我们  hexo 项目的根目录下就好啦~\n\n## 最终的 .travis.yml 配置\n\n```bash\nlanguage: node_js\n\nnode_js:\n  - \"10\"\n\ncache:\n  apt: true\n  directories:\n    - node_modules\n\nbefore_install:\n- openssl aes-256-cbc -K $encrypted_1fc90f464345_key -iv $encrypted_1fc90f464345_iv\n  -in id_rsa.enc -out ~\\/.ssh/id_rsa -d\n- chmod 600 ~/.ssh/id_rsa\n\naddons:\n  ssh_known_hosts: $DEPLOY_IP\n\nscript:\n  - hexo clean && hexo generate\n\nafter_success:\n  - pwd\n  - scp -o StrictHostKeyChecking=no -r public/*  root@$DEPLOY_IP:/opt/hexoBlog/\n\nbranches:\n  only:\n    - master\n\nnotifications:\n  email:\n    - huguobo2010@126.com\n  on_success: change\n  on_failure: always\n```","slug":"Travis-CI持续集成Hexo到云服务器","published":1,"updated":"2019-09-01T12:36:56.889Z","_id":"ck00w6z1e0000ocoxn3ef7zp3","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>烦：每次本地提交代码到 GitHub 上后还要自己手动同步文件到云服务器，完成所谓的部署工作有点麻烦和脱节。<br>懒：程序员等所有自称工程师进步的先决动力，想实现一个我每次提交代码后，后面的构建，打包和部署都自动进行的流程。<br>因为本身代码托管在 Github 上，所以就开始折腾 Travis-CI了。</p>\n</blockquote>\n<h2 id=\"什么是CI\"><a href=\"#什么是CI\" class=\"headerlink\" title=\"什么是CI\"></a>什么是CI</h2><p>持续集成服务（Continuous Integration，简称 CI）。<br>一般指的是提供一个运行环境，自动化执行单元测试，规范检查，基于环境的构建，服务部署等流水线作业。<br>持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。<br>另外，这个是工程化实践，如果你觉得自己手动操作比整这些繁琐的流程方便多了，我觉得也是没问题的。</p>\n<h2 id=\"Travis-CI\"><a href=\"#Travis-CI\" class=\"headerlink\" title=\"Travis CI\"></a>Travis CI</h2><p><a href=\"https://travis-ci.com/\" target=\"_blank\" rel=\"noopener\">Travis CI</a> 对 Github 上的开源项目提供免费服务，这要求必须有 Github 账号。界面也很赞~，让我想起了前东家的 PLUS 发布系统。<br><img src=\"/images/travis.png\" alt=\"travis\"><br>可以使用 github 账号直接登录， public 的仓库也直接同步到 Travis 上了， 选择想开启 Travis CI 的仓库，打开开关即可。详细配置不细说了，图形化界面，进去就知道了。</p>\n<h3 id=\"travis-yml\"><a href=\"#travis-yml\" class=\"headerlink\" title=\".travis.yml\"></a>.travis.yml</h3><p>Travis-CI配置文件，存放在项目根目录下。<br>支持多种语言，在配置文件中 <code>language: node_js</code><br>一个比较完整的生命周期</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">before_install</span><br><span class=\"line\">install</span><br><span class=\"line\">before_script</span><br><span class=\"line\">script</span><br><span class=\"line\">aftersuccess or afterfailure</span><br><span class=\"line\">[OPTIONAL] before_deploy</span><br><span class=\"line\">[OPTIONAL] deploy</span><br><span class=\"line\">[OPTIONAL] after_deploy</span><br><span class=\"line\">after_script</span><br></pre></td></tr></table></figure>\n\n<p>详细配置参考 <a href=\"https://docs.travis-ci.com\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n<h2 id=\"一些准备工作\"><a href=\"#一些准备工作\" class=\"headerlink\" title=\"一些准备工作\"></a>一些准备工作</h2><p>由于后面的免密登录和部署流程会涉及一些环境和配置类的操作，这个部分介绍下前置条件。</p>\n<h3 id=\"SCP命令\"><a href=\"#SCP命令\" class=\"headerlink\" title=\"SCP命令\"></a>SCP命令</h3><p>scp 命令用于linux下的跨主机之间的文件和目录复制<br>在首次连接服务器时，会弹出公钥确认的提示。这会导致某些自动化任务，由于初次连接服务器而导致自动化任务中断，<br>可在 StrictHostKeyChecking选项，用 -o 参数指定后，则不检查该项。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp [可选参数] file_source file_target</span><br><span class=\"line\"><span class=\"comment\">#将public目录下的所有文件复制到$DEPLOY_IP下的/path/to/blog目录中。不检查key，</span></span><br><span class=\"line\">scp -o StrictHostKeyChecking=no -r public/*  user@<span class=\"variable\">$DEPLOY_IP</span>:/path/to/blog/</span><br><span class=\"line\"><span class=\"comment\">#可用-i指定私钥。</span></span><br><span class=\"line\">scp -o  StrictHostKeyChecking=no -i .ssh/id_rsa yourfile user@destinate_ip:/dest_folder</span><br><span class=\"line\"><span class=\"comment\">#或将自己的公钥放到目标机的authorized_keys文件里，使自己为目标机的信任机器，实现无密码登录</span></span><br><span class=\"line\"><span class=\"comment\">#这个是在生成ssh key 后，将公钥放到authorized_keys文件中。使用密钥对可以实现不输入密码</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~/.ssh</span><br><span class=\"line\">cat id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"centOS使用gem\"><a href=\"#centOS使用gem\" class=\"headerlink\" title=\"centOS使用gem\"></a>centOS使用gem</h3><p>因为后面要使用 <code>gem install travis</code> ,所以可能会需要 升级 ruby 和 切换 gem 源（亲测 ruby 版本低会安装报错，gem 用官方源真的是动都不动啊，太难了）</p>\n<h4 id=\"切换gem源\"><a href=\"#切换gem源\" class=\"headerlink\" title=\"切换gem源\"></a>切换gem源</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/</span><br><span class=\"line\">$ gem sources -l</span><br><span class=\"line\">https://gems.ruby-china.com</span><br><span class=\"line\"><span class=\"comment\"># 确保只有 gems.ruby-china.com</span></span><br><span class=\"line\">$ gem update --system </span><br><span class=\"line\">$ gem -v</span><br><span class=\"line\">2.6.3</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"升级Ruby\"><a href=\"#升级Ruby\" class=\"headerlink\" title=\"升级Ruby\"></a>升级Ruby</h4><p>安装<a href=\"https://rvm.io/\" target=\"_blank\" rel=\"noopener\">RAM</a>, 一款ruby版本管理工具，类似 node 的 nvm。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB</span><br><span class=\"line\">curl -sSL https://get.rvm.io | bash -s stable</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile.d/rvm.sh</span><br><span class=\"line\">rvm -v</span><br></pre></td></tr></table></figure>\n\n<p>安装新版 ruby</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rvm install 2.6</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"自动部署到远程服务器\"><a href=\"#自动部署到远程服务器\" class=\"headerlink\" title=\"自动部署到远程服务器\"></a>自动部署到远程服务器</h2><p>对于项目的构建来说都是 执行配置文件中写好的脚本，这个项目可能 就是 <code>npm install &amp;&amp; hexo clean &amp;&amp; hexo g</code>, 那么怎么执行最后一步，把文件同步传输到 云服务器上呢。 我们使用CI就是手动过程太繁琐，重复没有意义，怎么实现 <code>免密</code> 部署呢。</p>\n<p>登录到 <code>云服务器(centOS 7.x)</code>,进行如下操作</p>\n<h3 id=\"生成-ssh-key\"><a href=\"#生成-ssh-key\" class=\"headerlink\" title=\"生成 ssh key\"></a>生成 ssh key</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> ~/.ssh</span><br><span class=\"line\"><span class=\"comment\"># create ssh key</span></span><br><span class=\"line\">ssh-keygen -t rsa -b 4096 -C <span class=\"string\">\"TravisCIDeployKey\"</span>  <span class=\"comment\">#一直回车</span></span><br><span class=\"line\"></span><br><span class=\"line\">ls</span><br><span class=\"line\"><span class=\"comment\"># 可以看到.ssh目录下得到了两个文件：id_rsa（私有秘钥）和id_rsa.pub（公有密钥）</span></span><br><span class=\"line\"><span class=\"comment\">#id_rsa  id_rsa.pub</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#append the public key to the list of \"authorized keys\":</span></span><br><span class=\"line\">cat id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载-travis-输出对应加密的私钥到-travis\"><a href=\"#下载-travis-输出对应加密的私钥到-travis\" class=\"headerlink\" title=\"下载 travis 输出对应加密的私钥到 travis\"></a>下载 travis 输出对应加密的私钥到 travis</h3><p>为了达到免密登录的效果，势必要用到ssh登录，肯定要告诉 travis 我们远程服务器的用户名密码，但是直接给明文不太好， travis 提供了加密功能。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gem install travis <span class=\"comment\">#  这步失败的话请看上面关于升级ruby和切换gem源的部分</span></span><br><span class=\"line\">travis login</span><br></pre></td></tr></table></figure>\n\n<p>登录 github 账号密码，这个安全直接连接的 github 服务<br><img src=\"/images/login.png\" alt=\"login\"></p>\n<p>加密私钥，生成.travis.yml </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch .travis.yml &amp;&amp; travis encrypt-file ~/.ssh/id_rsa --add -r huguobo/hexo-blog</span><br><span class=\"line\">cat .travis.yml  </span><br><span class=\"line\"><span class=\"comment\">### .travis.yml  内容</span></span><br><span class=\"line\">before_install:</span><br><span class=\"line\">- openssl aes-256-cbc -K <span class=\"variable\">$encrypted_77965d5bdd4d_key</span> -iv <span class=\"variable\">$encrypted_77965d5bdd4d_iv</span></span><br><span class=\"line\">  -<span class=\"keyword\">in</span> id_rsa.enc -out ./id_rsa -d</span><br></pre></td></tr></table></figure>\n\n<p>.travis.yml 的内容复制到你项目里的 .travis.yml 内，为保证权限正常，多加一行设置权限的 shell</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">before_install:</span><br><span class=\"line\">  - openssl aes-256-cbc -K <span class=\"variable\">$encrypted_d89376f3278d_key</span> -iv <span class=\"variable\">$encrypted_d89376f3278d_iv</span></span><br><span class=\"line\">    -<span class=\"keyword\">in</span> id_rsa.enc -out ~/.ssh/id_rsa -d</span><br><span class=\"line\">  - chmod 600 ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>\n\n<p>$encrypted_77965d5bdd4d_key 和 $encrypted_77965d5bdd4d_iv 是travis 帮忙生成的环境变量，已经同步到 huguobo/hexo-blog 这个项目上了。<br><img src=\"/images/iv.png\" alt=\"iv\"></p>\n<p>还有一点可能会用上，因为 travis 第一次登录远程服务器会出现 SSH 主机验证，这边会有一个主机信任问题。官方给出的方案是添加 addons 配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addons:</span><br><span class=\"line\">  ssh_known_hosts: your-ip</span><br></pre></td></tr></table></figure>\n\n<p>项目根目录下的 <code>id_rsa.enc</code> 文件就是我们加密的私钥文件, 把它复制到我们  hexo 项目的根目录下就好啦~</p>\n<h2 id=\"最终的-travis-yml-配置\"><a href=\"#最终的-travis-yml-配置\" class=\"headerlink\" title=\"最终的 .travis.yml 配置\"></a>最终的 .travis.yml 配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">language: node_js</span><br><span class=\"line\"></span><br><span class=\"line\">node_js:</span><br><span class=\"line\">  - <span class=\"string\">\"10\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">cache:</span><br><span class=\"line\">  apt: <span class=\"literal\">true</span></span><br><span class=\"line\">  directories:</span><br><span class=\"line\">    - node_modules</span><br><span class=\"line\"></span><br><span class=\"line\">before_install:</span><br><span class=\"line\">- openssl aes-256-cbc -K <span class=\"variable\">$encrypted_1fc90f464345_key</span> -iv <span class=\"variable\">$encrypted_1fc90f464345_iv</span></span><br><span class=\"line\">  -<span class=\"keyword\">in</span> id_rsa.enc -out ~\\/.ssh/id_rsa -d</span><br><span class=\"line\">- chmod 600 ~/.ssh/id_rsa</span><br><span class=\"line\"></span><br><span class=\"line\">addons:</span><br><span class=\"line\">  ssh_known_hosts: <span class=\"variable\">$DEPLOY_IP</span></span><br><span class=\"line\"></span><br><span class=\"line\">script:</span><br><span class=\"line\">  - hexo clean &amp;&amp; hexo generate</span><br><span class=\"line\"></span><br><span class=\"line\">after_success:</span><br><span class=\"line\">  - <span class=\"built_in\">pwd</span></span><br><span class=\"line\">  - scp -o StrictHostKeyChecking=no -r public/*  root@<span class=\"variable\">$DEPLOY_IP</span>:/opt/hexoBlog/</span><br><span class=\"line\"></span><br><span class=\"line\">branches:</span><br><span class=\"line\">  only:</span><br><span class=\"line\">    - master</span><br><span class=\"line\"></span><br><span class=\"line\">notifications:</span><br><span class=\"line\">  email:</span><br><span class=\"line\">    - huguobo2010@126.com</span><br><span class=\"line\">  on_success: change</span><br><span class=\"line\">  on_failure: always</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>烦：每次本地提交代码到 GitHub 上后还要自己手动同步文件到云服务器，完成所谓的部署工作有点麻烦和脱节。<br>懒：程序员等所有自称工程师进步的先决动力，想实现一个我每次提交代码后，后面的构建，打包和部署都自动进行的流程。<br>因为本身代码托管在 Github 上，所以就开始折腾 Travis-CI了。</p>\n</blockquote>\n<h2 id=\"什么是CI\"><a href=\"#什么是CI\" class=\"headerlink\" title=\"什么是CI\"></a>什么是CI</h2><p>持续集成服务（Continuous Integration，简称 CI）。<br>一般指的是提供一个运行环境，自动化执行单元测试，规范检查，基于环境的构建，服务部署等流水线作业。<br>持续集成的目的，就是让产品可以快速迭代，同时还能保持高质量。<br>另外，这个是工程化实践，如果你觉得自己手动操作比整这些繁琐的流程方便多了，我觉得也是没问题的。</p>\n<h2 id=\"Travis-CI\"><a href=\"#Travis-CI\" class=\"headerlink\" title=\"Travis CI\"></a>Travis CI</h2><p><a href=\"https://travis-ci.com/\" target=\"_blank\" rel=\"noopener\">Travis CI</a> 对 Github 上的开源项目提供免费服务，这要求必须有 Github 账号。界面也很赞~，让我想起了前东家的 PLUS 发布系统。<br><img src=\"/images/travis.png\" alt=\"travis\"><br>可以使用 github 账号直接登录， public 的仓库也直接同步到 Travis 上了， 选择想开启 Travis CI 的仓库，打开开关即可。详细配置不细说了，图形化界面，进去就知道了。</p>\n<h3 id=\"travis-yml\"><a href=\"#travis-yml\" class=\"headerlink\" title=\".travis.yml\"></a>.travis.yml</h3><p>Travis-CI配置文件，存放在项目根目录下。<br>支持多种语言，在配置文件中 <code>language: node_js</code><br>一个比较完整的生命周期</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">before_install</span><br><span class=\"line\">install</span><br><span class=\"line\">before_script</span><br><span class=\"line\">script</span><br><span class=\"line\">aftersuccess or afterfailure</span><br><span class=\"line\">[OPTIONAL] before_deploy</span><br><span class=\"line\">[OPTIONAL] deploy</span><br><span class=\"line\">[OPTIONAL] after_deploy</span><br><span class=\"line\">after_script</span><br></pre></td></tr></table></figure>\n\n<p>详细配置参考 <a href=\"https://docs.travis-ci.com\" target=\"_blank\" rel=\"noopener\">官方文档</a></p>\n<h2 id=\"一些准备工作\"><a href=\"#一些准备工作\" class=\"headerlink\" title=\"一些准备工作\"></a>一些准备工作</h2><p>由于后面的免密登录和部署流程会涉及一些环境和配置类的操作，这个部分介绍下前置条件。</p>\n<h3 id=\"SCP命令\"><a href=\"#SCP命令\" class=\"headerlink\" title=\"SCP命令\"></a>SCP命令</h3><p>scp 命令用于linux下的跨主机之间的文件和目录复制<br>在首次连接服务器时，会弹出公钥确认的提示。这会导致某些自动化任务，由于初次连接服务器而导致自动化任务中断，<br>可在 StrictHostKeyChecking选项，用 -o 参数指定后，则不检查该项。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp [可选参数] file_source file_target</span><br><span class=\"line\"><span class=\"comment\">#将public目录下的所有文件复制到$DEPLOY_IP下的/path/to/blog目录中。不检查key，</span></span><br><span class=\"line\">scp -o StrictHostKeyChecking=no -r public/*  user@<span class=\"variable\">$DEPLOY_IP</span>:/path/to/blog/</span><br><span class=\"line\"><span class=\"comment\">#可用-i指定私钥。</span></span><br><span class=\"line\">scp -o  StrictHostKeyChecking=no -i .ssh/id_rsa yourfile user@destinate_ip:/dest_folder</span><br><span class=\"line\"><span class=\"comment\">#或将自己的公钥放到目标机的authorized_keys文件里，使自己为目标机的信任机器，实现无密码登录</span></span><br><span class=\"line\"><span class=\"comment\">#这个是在生成ssh key 后，将公钥放到authorized_keys文件中。使用密钥对可以实现不输入密码</span></span><br><span class=\"line\"><span class=\"built_in\">cd</span> ~/.ssh</span><br><span class=\"line\">cat id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"centOS使用gem\"><a href=\"#centOS使用gem\" class=\"headerlink\" title=\"centOS使用gem\"></a>centOS使用gem</h3><p>因为后面要使用 <code>gem install travis</code> ,所以可能会需要 升级 ruby 和 切换 gem 源（亲测 ruby 版本低会安装报错，gem 用官方源真的是动都不动啊，太难了）</p>\n<h4 id=\"切换gem源\"><a href=\"#切换gem源\" class=\"headerlink\" title=\"切换gem源\"></a>切换gem源</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/</span><br><span class=\"line\">$ gem sources -l</span><br><span class=\"line\">https://gems.ruby-china.com</span><br><span class=\"line\"><span class=\"comment\"># 确保只有 gems.ruby-china.com</span></span><br><span class=\"line\">$ gem update --system </span><br><span class=\"line\">$ gem -v</span><br><span class=\"line\">2.6.3</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"升级Ruby\"><a href=\"#升级Ruby\" class=\"headerlink\" title=\"升级Ruby\"></a>升级Ruby</h4><p>安装<a href=\"https://rvm.io/\" target=\"_blank\" rel=\"noopener\">RAM</a>, 一款ruby版本管理工具，类似 node 的 nvm。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB</span><br><span class=\"line\">curl -sSL https://get.rvm.io | bash -s stable</span><br><span class=\"line\"><span class=\"built_in\">source</span> /etc/profile.d/rvm.sh</span><br><span class=\"line\">rvm -v</span><br></pre></td></tr></table></figure>\n\n<p>安装新版 ruby</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">rvm install 2.6</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"自动部署到远程服务器\"><a href=\"#自动部署到远程服务器\" class=\"headerlink\" title=\"自动部署到远程服务器\"></a>自动部署到远程服务器</h2><p>对于项目的构建来说都是 执行配置文件中写好的脚本，这个项目可能 就是 <code>npm install &amp;&amp; hexo clean &amp;&amp; hexo g</code>, 那么怎么执行最后一步，把文件同步传输到 云服务器上呢。 我们使用CI就是手动过程太繁琐，重复没有意义，怎么实现 <code>免密</code> 部署呢。</p>\n<p>登录到 <code>云服务器(centOS 7.x)</code>,进行如下操作</p>\n<h3 id=\"生成-ssh-key\"><a href=\"#生成-ssh-key\" class=\"headerlink\" title=\"生成 ssh key\"></a>生成 ssh key</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> ~/.ssh</span><br><span class=\"line\"><span class=\"comment\"># create ssh key</span></span><br><span class=\"line\">ssh-keygen -t rsa -b 4096 -C <span class=\"string\">\"TravisCIDeployKey\"</span>  <span class=\"comment\">#一直回车</span></span><br><span class=\"line\"></span><br><span class=\"line\">ls</span><br><span class=\"line\"><span class=\"comment\"># 可以看到.ssh目录下得到了两个文件：id_rsa（私有秘钥）和id_rsa.pub（公有密钥）</span></span><br><span class=\"line\"><span class=\"comment\">#id_rsa  id_rsa.pub</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#append the public key to the list of \"authorized keys\":</span></span><br><span class=\"line\">cat id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载-travis-输出对应加密的私钥到-travis\"><a href=\"#下载-travis-输出对应加密的私钥到-travis\" class=\"headerlink\" title=\"下载 travis 输出对应加密的私钥到 travis\"></a>下载 travis 输出对应加密的私钥到 travis</h3><p>为了达到免密登录的效果，势必要用到ssh登录，肯定要告诉 travis 我们远程服务器的用户名密码，但是直接给明文不太好， travis 提供了加密功能。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">gem install travis <span class=\"comment\">#  这步失败的话请看上面关于升级ruby和切换gem源的部分</span></span><br><span class=\"line\">travis login</span><br></pre></td></tr></table></figure>\n\n<p>登录 github 账号密码，这个安全直接连接的 github 服务<br><img src=\"/images/login.png\" alt=\"login\"></p>\n<p>加密私钥，生成.travis.yml </p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch .travis.yml &amp;&amp; travis encrypt-file ~/.ssh/id_rsa --add -r huguobo/hexo-blog</span><br><span class=\"line\">cat .travis.yml  </span><br><span class=\"line\"><span class=\"comment\">### .travis.yml  内容</span></span><br><span class=\"line\">before_install:</span><br><span class=\"line\">- openssl aes-256-cbc -K <span class=\"variable\">$encrypted_77965d5bdd4d_key</span> -iv <span class=\"variable\">$encrypted_77965d5bdd4d_iv</span></span><br><span class=\"line\">  -<span class=\"keyword\">in</span> id_rsa.enc -out ./id_rsa -d</span><br></pre></td></tr></table></figure>\n\n<p>.travis.yml 的内容复制到你项目里的 .travis.yml 内，为保证权限正常，多加一行设置权限的 shell</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">before_install:</span><br><span class=\"line\">  - openssl aes-256-cbc -K <span class=\"variable\">$encrypted_d89376f3278d_key</span> -iv <span class=\"variable\">$encrypted_d89376f3278d_iv</span></span><br><span class=\"line\">    -<span class=\"keyword\">in</span> id_rsa.enc -out ~/.ssh/id_rsa -d</span><br><span class=\"line\">  - chmod 600 ~/.ssh/id_rsa</span><br></pre></td></tr></table></figure>\n\n<p>$encrypted_77965d5bdd4d_key 和 $encrypted_77965d5bdd4d_iv 是travis 帮忙生成的环境变量，已经同步到 huguobo/hexo-blog 这个项目上了。<br><img src=\"/images/iv.png\" alt=\"iv\"></p>\n<p>还有一点可能会用上，因为 travis 第一次登录远程服务器会出现 SSH 主机验证，这边会有一个主机信任问题。官方给出的方案是添加 addons 配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addons:</span><br><span class=\"line\">  ssh_known_hosts: your-ip</span><br></pre></td></tr></table></figure>\n\n<p>项目根目录下的 <code>id_rsa.enc</code> 文件就是我们加密的私钥文件, 把它复制到我们  hexo 项目的根目录下就好啦~</p>\n<h2 id=\"最终的-travis-yml-配置\"><a href=\"#最终的-travis-yml-配置\" class=\"headerlink\" title=\"最终的 .travis.yml 配置\"></a>最终的 .travis.yml 配置</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">language: node_js</span><br><span class=\"line\"></span><br><span class=\"line\">node_js:</span><br><span class=\"line\">  - <span class=\"string\">\"10\"</span></span><br><span class=\"line\"></span><br><span class=\"line\">cache:</span><br><span class=\"line\">  apt: <span class=\"literal\">true</span></span><br><span class=\"line\">  directories:</span><br><span class=\"line\">    - node_modules</span><br><span class=\"line\"></span><br><span class=\"line\">before_install:</span><br><span class=\"line\">- openssl aes-256-cbc -K <span class=\"variable\">$encrypted_1fc90f464345_key</span> -iv <span class=\"variable\">$encrypted_1fc90f464345_iv</span></span><br><span class=\"line\">  -<span class=\"keyword\">in</span> id_rsa.enc -out ~\\/.ssh/id_rsa -d</span><br><span class=\"line\">- chmod 600 ~/.ssh/id_rsa</span><br><span class=\"line\"></span><br><span class=\"line\">addons:</span><br><span class=\"line\">  ssh_known_hosts: <span class=\"variable\">$DEPLOY_IP</span></span><br><span class=\"line\"></span><br><span class=\"line\">script:</span><br><span class=\"line\">  - hexo clean &amp;&amp; hexo generate</span><br><span class=\"line\"></span><br><span class=\"line\">after_success:</span><br><span class=\"line\">  - <span class=\"built_in\">pwd</span></span><br><span class=\"line\">  - scp -o StrictHostKeyChecking=no -r public/*  root@<span class=\"variable\">$DEPLOY_IP</span>:/opt/hexoBlog/</span><br><span class=\"line\"></span><br><span class=\"line\">branches:</span><br><span class=\"line\">  only:</span><br><span class=\"line\">    - master</span><br><span class=\"line\"></span><br><span class=\"line\">notifications:</span><br><span class=\"line\">  email:</span><br><span class=\"line\">    - huguobo2010@126.com</span><br><span class=\"line\">  on_success: change</span><br><span class=\"line\">  on_failure: always</span><br></pre></td></tr></table></figure>"},{"title":"Nginx 配置 SSL","date":"2019-08-31T02:35:31.000Z","_content":"\n> 域名貌似备案成功了，解析到腾讯云服务器ip后，发现直接访问 http://huguobo.site 是可以的 换成 https 不行了。应该是没有配置SSL导致的。\n\n## 什么是HTTPS\nhttps 全称：Hyper Text Transfer Protocol over Secure Socket Layer，是http的安全版。即http下加入SSL协议层，因此https的安全基础就是SSL，所以加密内容需要SSL。\n\n## SSL原理\n- 浏览器发送一个https的请求给服务器；\n- 服务器要有一套数字证书，可以自己制作，也可以向组织申请，区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面，这套证书其实就是一对公钥和私钥；\n- 服务器会把公钥传输给客户端；\n- 客户端（浏览器）收到公钥后，会验证其是否合法有效，无效会有警告提醒，有效则会生成一串随机数，并用收到的公钥加密；\n- 客户端把加密后的随机字符串传输给服务器；\n- 服务器收到加密随机字符串后，先用私钥解密（公钥加密，私钥解密），获取到这一串随机数后，再用这串随机字符串加密传输的数据（该加密为对称加密，所谓对称加密，就是将数据和私钥也就是这个随机字符串>通过某种算法混合在一起，这样除非知道私钥，否则无法获取数据内容）；\n- 服务器把加密后的数据传输给客户端；\n- 客户端收到数据后，再用自己的私钥也就是那个随机字符串解密；\n\n## 配置 with-http_ssl_module 模块\n首先需要申请一个证书，可以申请一个免费的。\n参考下面的 `其他方式` 部分可以直接在云服务厂商可视化界面申请并下载~\n然后会得到nginx版本证书，一个公钥（证书），一个私钥，将其上传到服务器。\n\n先确认`nginx`安装时已编译`http_ssl`模块，也就是执行`nginx -V`命令查看是否存在 `--with-http_ssl_module`。如果没有，则需要重新编译nginx将该模块加入。\n若有的话此步骤跳过\n若ssl模块没有先编译一下\n\n```bash\ncd /usr/local/src/nginx-1.12.1/  #nginx版本号可能不同哟\n\n./configure --help | grep -i ssl\n  --with-http_ssl_module \n  \n./configure --prefix=/usr/local/nginx --with-http_ssl_module\n\n```\n\n## 生成 ssl 秘钥对\n```bash\ncd /usr/local/nginx/conf\n\nyum install -y openssl\n```\n\n### 使用RSA算法生产key\n```bash\nopenssl genrsa -des3 -out tmp.key 2048\n# 生成一个rsa类型的密钥，且长度为2048，但是我们有发现，让我们设置密码，如果每次有人访问我们的站点，都需要输入密码，太麻烦了\n```\n所以我们要转换私钥，取消密码（其实tmp.key与zhdy.key密钥内容是一样的，只不过一个有密码一个没有）：\n```bash\nopenssl rsa -in tmp.key -out zhdy.key \n\nrm -f tmp.key\n```\n### 创建证书申请\n```\nopenssl req -new -key zhdy.key -out zhdy.csr\n```\n\n### 创建自签名的证书\n```bash\nopenssl x509 -req -days 365 -in zhdy.csr -signkey zhdy.key -out zhdy.crt\n```\n\n## Nginx 配置 ssl\n```bash\nserver\n{\n    listen 443;\n    server_name huguobo.site; # 换成你自己的域名服务哟\n    index index.html index.php;\n    root /path/to/your/file \n    ssl on;\n    ssl_certificate zhdy.crt;\n    ssl_certificate_key zhdy.key;\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n}\n\n# ssl on; 代表着打开ssl\n#ssl_certificate zhdy.crt; 公钥\n# ssl_certificate_key zhdy.key; 私钥\n# ssl_protocols TLSv1 TLSv1.1 TLSv1.2; 三种不同的协议\n```\n\n## 测试\n```bash\nnginx -t\nnginx restart\n```\n\n由于已经设置了443，所以我们使用curl -x 是不生效的。\n我们修改下/etc/hosts为: `yourip www.aaa.com`\n\n```bash\ncurl https://haha.com\n```\n报错显示为“此证书非安全证书”，但是ssl是已经成功配置了\n\n## 其他方式（更快捷）\n后来发现各个厂商也提供申请证书的入口，也提供 DNS 和 文件验证两种配置,大家也可以自行参考配置\n[腾讯云ssl控制台](https://console.cloud.tencent.com/ssl)\n[nginx配置文档](https://cloud.tencent.com/document/product/400/35244)\n\n这种从供应商处可以直接下载到证书，然后nginx的配置秘钥和证书都在 nginx 文件夹下\n\n从客户端传送文件到云主机（MAC）\n```bash\nscp  ./2_huguobo.site.key ./1_huguobo.site_bundle.crt  root@118.24.215.220:/usr/local/nginx/conf\n```\n登录云主机 nginx 配置\n```bash\n# Settings for a TLS enabled server.\n\n    server {\n        listen       443 ssl http2 default_server;\n        listen       [::]:443 ssl http2 default_server;\n        server_name  huguobo.site;\n\n        ssl on;\n        ssl_certificate \"/usr/local/nginx/conf/1_huguobo.site_bundle.crt\";\n        ssl_certificate_key \"/usr/local/nginx/conf/2_huguobo.site.key\";\n        ssl_session_cache shared:SSL:1m;\n        ssl_session_timeout  10m;\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_prefer_server_ciphers on;\n        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; #请按照这个套件配置，配置加密套件，写法遵循 openssl 标准。\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n           root /home/hexoBlog; # your path\n           index index.html;\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n   }\n\n```\n## 强制HTTPS\n我没有做强制https。但是需要的话，改下 nginx 配置文件即可\nhttp 默认是`80`端口 ，https 是`443`端口\n```bash\nserver{\n      listen 80;    #表示监听80端口\n      server_name huguobo.site\n      location / {    #将80端口强制转为https\n          rewrite (.*) https://huguobo.site$1 permanent;\n      }\n}\n```\n","source":"_posts/nginx配置ssl.md","raw":"---\ntitle: Nginx 配置 SSL\ndate: 2019-08-31 10:35:31\ntags:\n- nginx\n- devOps\n---\n\n> 域名貌似备案成功了，解析到腾讯云服务器ip后，发现直接访问 http://huguobo.site 是可以的 换成 https 不行了。应该是没有配置SSL导致的。\n\n## 什么是HTTPS\nhttps 全称：Hyper Text Transfer Protocol over Secure Socket Layer，是http的安全版。即http下加入SSL协议层，因此https的安全基础就是SSL，所以加密内容需要SSL。\n\n## SSL原理\n- 浏览器发送一个https的请求给服务器；\n- 服务器要有一套数字证书，可以自己制作，也可以向组织申请，区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面，这套证书其实就是一对公钥和私钥；\n- 服务器会把公钥传输给客户端；\n- 客户端（浏览器）收到公钥后，会验证其是否合法有效，无效会有警告提醒，有效则会生成一串随机数，并用收到的公钥加密；\n- 客户端把加密后的随机字符串传输给服务器；\n- 服务器收到加密随机字符串后，先用私钥解密（公钥加密，私钥解密），获取到这一串随机数后，再用这串随机字符串加密传输的数据（该加密为对称加密，所谓对称加密，就是将数据和私钥也就是这个随机字符串>通过某种算法混合在一起，这样除非知道私钥，否则无法获取数据内容）；\n- 服务器把加密后的数据传输给客户端；\n- 客户端收到数据后，再用自己的私钥也就是那个随机字符串解密；\n\n## 配置 with-http_ssl_module 模块\n首先需要申请一个证书，可以申请一个免费的。\n参考下面的 `其他方式` 部分可以直接在云服务厂商可视化界面申请并下载~\n然后会得到nginx版本证书，一个公钥（证书），一个私钥，将其上传到服务器。\n\n先确认`nginx`安装时已编译`http_ssl`模块，也就是执行`nginx -V`命令查看是否存在 `--with-http_ssl_module`。如果没有，则需要重新编译nginx将该模块加入。\n若有的话此步骤跳过\n若ssl模块没有先编译一下\n\n```bash\ncd /usr/local/src/nginx-1.12.1/  #nginx版本号可能不同哟\n\n./configure --help | grep -i ssl\n  --with-http_ssl_module \n  \n./configure --prefix=/usr/local/nginx --with-http_ssl_module\n\n```\n\n## 生成 ssl 秘钥对\n```bash\ncd /usr/local/nginx/conf\n\nyum install -y openssl\n```\n\n### 使用RSA算法生产key\n```bash\nopenssl genrsa -des3 -out tmp.key 2048\n# 生成一个rsa类型的密钥，且长度为2048，但是我们有发现，让我们设置密码，如果每次有人访问我们的站点，都需要输入密码，太麻烦了\n```\n所以我们要转换私钥，取消密码（其实tmp.key与zhdy.key密钥内容是一样的，只不过一个有密码一个没有）：\n```bash\nopenssl rsa -in tmp.key -out zhdy.key \n\nrm -f tmp.key\n```\n### 创建证书申请\n```\nopenssl req -new -key zhdy.key -out zhdy.csr\n```\n\n### 创建自签名的证书\n```bash\nopenssl x509 -req -days 365 -in zhdy.csr -signkey zhdy.key -out zhdy.crt\n```\n\n## Nginx 配置 ssl\n```bash\nserver\n{\n    listen 443;\n    server_name huguobo.site; # 换成你自己的域名服务哟\n    index index.html index.php;\n    root /path/to/your/file \n    ssl on;\n    ssl_certificate zhdy.crt;\n    ssl_certificate_key zhdy.key;\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n}\n\n# ssl on; 代表着打开ssl\n#ssl_certificate zhdy.crt; 公钥\n# ssl_certificate_key zhdy.key; 私钥\n# ssl_protocols TLSv1 TLSv1.1 TLSv1.2; 三种不同的协议\n```\n\n## 测试\n```bash\nnginx -t\nnginx restart\n```\n\n由于已经设置了443，所以我们使用curl -x 是不生效的。\n我们修改下/etc/hosts为: `yourip www.aaa.com`\n\n```bash\ncurl https://haha.com\n```\n报错显示为“此证书非安全证书”，但是ssl是已经成功配置了\n\n## 其他方式（更快捷）\n后来发现各个厂商也提供申请证书的入口，也提供 DNS 和 文件验证两种配置,大家也可以自行参考配置\n[腾讯云ssl控制台](https://console.cloud.tencent.com/ssl)\n[nginx配置文档](https://cloud.tencent.com/document/product/400/35244)\n\n这种从供应商处可以直接下载到证书，然后nginx的配置秘钥和证书都在 nginx 文件夹下\n\n从客户端传送文件到云主机（MAC）\n```bash\nscp  ./2_huguobo.site.key ./1_huguobo.site_bundle.crt  root@118.24.215.220:/usr/local/nginx/conf\n```\n登录云主机 nginx 配置\n```bash\n# Settings for a TLS enabled server.\n\n    server {\n        listen       443 ssl http2 default_server;\n        listen       [::]:443 ssl http2 default_server;\n        server_name  huguobo.site;\n\n        ssl on;\n        ssl_certificate \"/usr/local/nginx/conf/1_huguobo.site_bundle.crt\";\n        ssl_certificate_key \"/usr/local/nginx/conf/2_huguobo.site.key\";\n        ssl_session_cache shared:SSL:1m;\n        ssl_session_timeout  10m;\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n        ssl_prefer_server_ciphers on;\n        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; #请按照这个套件配置，配置加密套件，写法遵循 openssl 标准。\n\n        # Load configuration files for the default server block.\n        include /etc/nginx/default.d/*.conf;\n\n        location / {\n           root /home/hexoBlog; # your path\n           index index.html;\n        }\n\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n   }\n\n```\n## 强制HTTPS\n我没有做强制https。但是需要的话，改下 nginx 配置文件即可\nhttp 默认是`80`端口 ，https 是`443`端口\n```bash\nserver{\n      listen 80;    #表示监听80端口\n      server_name huguobo.site\n      location / {    #将80端口强制转为https\n          rewrite (.*) https://huguobo.site$1 permanent;\n      }\n}\n```\n","slug":"nginx配置ssl","published":1,"updated":"2019-09-01T04:08:11.816Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck00w6z1i0002ocox2bu3e87d","content":"<blockquote>\n<p>域名貌似备案成功了，解析到腾讯云服务器ip后，发现直接访问 <a href=\"http://huguobo.site\">http://huguobo.site</a> 是可以的 换成 https 不行了。应该是没有配置SSL导致的。</p>\n</blockquote>\n<h2 id=\"什么是HTTPS\"><a href=\"#什么是HTTPS\" class=\"headerlink\" title=\"什么是HTTPS\"></a>什么是HTTPS</h2><p>https 全称：Hyper Text Transfer Protocol over Secure Socket Layer，是http的安全版。即http下加入SSL协议层，因此https的安全基础就是SSL，所以加密内容需要SSL。</p>\n<h2 id=\"SSL原理\"><a href=\"#SSL原理\" class=\"headerlink\" title=\"SSL原理\"></a>SSL原理</h2><ul>\n<li>浏览器发送一个https的请求给服务器；</li>\n<li>服务器要有一套数字证书，可以自己制作，也可以向组织申请，区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面，这套证书其实就是一对公钥和私钥；</li>\n<li>服务器会把公钥传输给客户端；</li>\n<li>客户端（浏览器）收到公钥后，会验证其是否合法有效，无效会有警告提醒，有效则会生成一串随机数，并用收到的公钥加密；</li>\n<li>客户端把加密后的随机字符串传输给服务器；</li>\n<li>服务器收到加密随机字符串后，先用私钥解密（公钥加密，私钥解密），获取到这一串随机数后，再用这串随机字符串加密传输的数据（该加密为对称加密，所谓对称加密，就是将数据和私钥也就是这个随机字符串&gt;通过某种算法混合在一起，这样除非知道私钥，否则无法获取数据内容）；</li>\n<li>服务器把加密后的数据传输给客户端；</li>\n<li>客户端收到数据后，再用自己的私钥也就是那个随机字符串解密；</li>\n</ul>\n<h2 id=\"配置-with-http-ssl-module-模块\"><a href=\"#配置-with-http-ssl-module-模块\" class=\"headerlink\" title=\"配置 with-http_ssl_module 模块\"></a>配置 with-http_ssl_module 模块</h2><p>首先需要申请一个证书，可以申请一个免费的。<br>参考下面的 <code>其他方式</code> 部分可以直接在云服务厂商可视化界面申请并下载~<br>然后会得到nginx版本证书，一个公钥（证书），一个私钥，将其上传到服务器。</p>\n<p>先确认<code>nginx</code>安装时已编译<code>http_ssl</code>模块，也就是执行<code>nginx -V</code>命令查看是否存在 <code>--with-http_ssl_module</code>。如果没有，则需要重新编译nginx将该模块加入。<br>若有的话此步骤跳过<br>若ssl模块没有先编译一下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/src/nginx-1.12.1/  <span class=\"comment\">#nginx版本号可能不同哟</span></span><br><span class=\"line\"></span><br><span class=\"line\">./configure --<span class=\"built_in\">help</span> | grep -i ssl</span><br><span class=\"line\">  --with-http_ssl_module </span><br><span class=\"line\">  </span><br><span class=\"line\">./configure --prefix=/usr/<span class=\"built_in\">local</span>/nginx --with-http_ssl_module</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"生成-ssl-秘钥对\"><a href=\"#生成-ssl-秘钥对\" class=\"headerlink\" title=\"生成 ssl 秘钥对\"></a>生成 ssl 秘钥对</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/nginx/conf</span><br><span class=\"line\"></span><br><span class=\"line\">yum install -y openssl</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用RSA算法生产key\"><a href=\"#使用RSA算法生产key\" class=\"headerlink\" title=\"使用RSA算法生产key\"></a>使用RSA算法生产key</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl genrsa -des3 -out tmp.key 2048</span><br><span class=\"line\"><span class=\"comment\"># 生成一个rsa类型的密钥，且长度为2048，但是我们有发现，让我们设置密码，如果每次有人访问我们的站点，都需要输入密码，太麻烦了</span></span><br></pre></td></tr></table></figure>\n\n<p>所以我们要转换私钥，取消密码（其实tmp.key与zhdy.key密钥内容是一样的，只不过一个有密码一个没有）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl rsa -<span class=\"keyword\">in</span> tmp.key -out zhdy.key </span><br><span class=\"line\"></span><br><span class=\"line\">rm -f tmp.key</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建证书申请\"><a href=\"#创建证书申请\" class=\"headerlink\" title=\"创建证书申请\"></a>创建证书申请</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl req -new -key zhdy.key -out zhdy.csr</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建自签名的证书\"><a href=\"#创建自签名的证书\" class=\"headerlink\" title=\"创建自签名的证书\"></a>创建自签名的证书</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl x509 -req -days 365 -<span class=\"keyword\">in</span> zhdy.csr -signkey zhdy.key -out zhdy.crt</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Nginx-配置-ssl\"><a href=\"#Nginx-配置-ssl\" class=\"headerlink\" title=\"Nginx 配置 ssl\"></a>Nginx 配置 ssl</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    listen 443;</span><br><span class=\"line\">    server_name huguobo.site; <span class=\"comment\"># 换成你自己的域名服务哟</span></span><br><span class=\"line\">    index index.html index.php;</span><br><span class=\"line\">    root /path/to/your/file </span><br><span class=\"line\">    ssl on;</span><br><span class=\"line\">    ssl_certificate zhdy.crt;</span><br><span class=\"line\">    ssl_certificate_key zhdy.key;</span><br><span class=\"line\">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ssl on; 代表着打开ssl</span></span><br><span class=\"line\"><span class=\"comment\">#ssl_certificate zhdy.crt; 公钥</span></span><br><span class=\"line\"><span class=\"comment\"># ssl_certificate_key zhdy.key; 私钥</span></span><br><span class=\"line\"><span class=\"comment\"># ssl_protocols TLSv1 TLSv1.1 TLSv1.2; 三种不同的协议</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -t</span><br><span class=\"line\">nginx restart</span><br></pre></td></tr></table></figure>\n\n<p>由于已经设置了443，所以我们使用curl -x 是不生效的。<br>我们修改下/etc/hosts为: <code>yourip www.aaa.com</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://haha.com</span><br></pre></td></tr></table></figure>\n\n<p>报错显示为“此证书非安全证书”，但是ssl是已经成功配置了</p>\n<h2 id=\"其他方式（更快捷）\"><a href=\"#其他方式（更快捷）\" class=\"headerlink\" title=\"其他方式（更快捷）\"></a>其他方式（更快捷）</h2><p>后来发现各个厂商也提供申请证书的入口，也提供 DNS 和 文件验证两种配置,大家也可以自行参考配置<br><a href=\"https://console.cloud.tencent.com/ssl\" target=\"_blank\" rel=\"noopener\">腾讯云ssl控制台</a><br><a href=\"https://cloud.tencent.com/document/product/400/35244\" target=\"_blank\" rel=\"noopener\">nginx配置文档</a></p>\n<p>这种从供应商处可以直接下载到证书，然后nginx的配置秘钥和证书都在 nginx 文件夹下</p>\n<p>从客户端传送文件到云主机（MAC）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp  ./2_huguobo.site.key ./1_huguobo.site_bundle.crt  root@118.24.215.220:/usr/<span class=\"built_in\">local</span>/nginx/conf</span><br></pre></td></tr></table></figure>\n\n<p>登录云主机 nginx 配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Settings for a TLS enabled server.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       443 ssl http2 default_server;</span><br><span class=\"line\">        listen       [::]:443 ssl http2 default_server;</span><br><span class=\"line\">        server_name  huguobo.site;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl on;</span><br><span class=\"line\">        ssl_certificate <span class=\"string\">\"/usr/local/nginx/conf/1_huguobo.site_bundle.crt\"</span>;</span><br><span class=\"line\">        ssl_certificate_key <span class=\"string\">\"/usr/local/nginx/conf/2_huguobo.site.key\"</span>;</span><br><span class=\"line\">        ssl_session_cache shared:SSL:1m;</span><br><span class=\"line\">        ssl_session_timeout  10m;</span><br><span class=\"line\">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class=\"line\">        ssl_prefer_server_ciphers on;</span><br><span class=\"line\">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; <span class=\"comment\">#请按照这个套件配置，配置加密套件，写法遵循 openssl 标准。</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Load configuration files for the default server block.</span></span><br><span class=\"line\">        include /etc/nginx/default.d/*.conf;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">           root /home/hexoBlog; <span class=\"comment\"># your path</span></span><br><span class=\"line\">           index index.html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        error_page 404 /404.html;</span><br><span class=\"line\">            location = /40x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        error_page 500 502 503 504 /50x.html;</span><br><span class=\"line\">            location = /50x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"强制HTTPS\"><a href=\"#强制HTTPS\" class=\"headerlink\" title=\"强制HTTPS\"></a>强制HTTPS</h2><p>我没有做强制https。但是需要的话，改下 nginx 配置文件即可<br>http 默认是<code>80</code>端口 ，https 是<code>443</code>端口</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">      listen 80;    <span class=\"comment\">#表示监听80端口</span></span><br><span class=\"line\">      server_name huguobo.site</span><br><span class=\"line\">      location / &#123;    <span class=\"comment\">#将80端口强制转为https</span></span><br><span class=\"line\">          rewrite (.*) https://huguobo.site<span class=\"variable\">$1</span> permanent;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>域名貌似备案成功了，解析到腾讯云服务器ip后，发现直接访问 <a href=\"http://huguobo.site\">http://huguobo.site</a> 是可以的 换成 https 不行了。应该是没有配置SSL导致的。</p>\n</blockquote>\n<h2 id=\"什么是HTTPS\"><a href=\"#什么是HTTPS\" class=\"headerlink\" title=\"什么是HTTPS\"></a>什么是HTTPS</h2><p>https 全称：Hyper Text Transfer Protocol over Secure Socket Layer，是http的安全版。即http下加入SSL协议层，因此https的安全基础就是SSL，所以加密内容需要SSL。</p>\n<h2 id=\"SSL原理\"><a href=\"#SSL原理\" class=\"headerlink\" title=\"SSL原理\"></a>SSL原理</h2><ul>\n<li>浏览器发送一个https的请求给服务器；</li>\n<li>服务器要有一套数字证书，可以自己制作，也可以向组织申请，区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面，这套证书其实就是一对公钥和私钥；</li>\n<li>服务器会把公钥传输给客户端；</li>\n<li>客户端（浏览器）收到公钥后，会验证其是否合法有效，无效会有警告提醒，有效则会生成一串随机数，并用收到的公钥加密；</li>\n<li>客户端把加密后的随机字符串传输给服务器；</li>\n<li>服务器收到加密随机字符串后，先用私钥解密（公钥加密，私钥解密），获取到这一串随机数后，再用这串随机字符串加密传输的数据（该加密为对称加密，所谓对称加密，就是将数据和私钥也就是这个随机字符串&gt;通过某种算法混合在一起，这样除非知道私钥，否则无法获取数据内容）；</li>\n<li>服务器把加密后的数据传输给客户端；</li>\n<li>客户端收到数据后，再用自己的私钥也就是那个随机字符串解密；</li>\n</ul>\n<h2 id=\"配置-with-http-ssl-module-模块\"><a href=\"#配置-with-http-ssl-module-模块\" class=\"headerlink\" title=\"配置 with-http_ssl_module 模块\"></a>配置 with-http_ssl_module 模块</h2><p>首先需要申请一个证书，可以申请一个免费的。<br>参考下面的 <code>其他方式</code> 部分可以直接在云服务厂商可视化界面申请并下载~<br>然后会得到nginx版本证书，一个公钥（证书），一个私钥，将其上传到服务器。</p>\n<p>先确认<code>nginx</code>安装时已编译<code>http_ssl</code>模块，也就是执行<code>nginx -V</code>命令查看是否存在 <code>--with-http_ssl_module</code>。如果没有，则需要重新编译nginx将该模块加入。<br>若有的话此步骤跳过<br>若ssl模块没有先编译一下</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/src/nginx-1.12.1/  <span class=\"comment\">#nginx版本号可能不同哟</span></span><br><span class=\"line\"></span><br><span class=\"line\">./configure --<span class=\"built_in\">help</span> | grep -i ssl</span><br><span class=\"line\">  --with-http_ssl_module </span><br><span class=\"line\">  </span><br><span class=\"line\">./configure --prefix=/usr/<span class=\"built_in\">local</span>/nginx --with-http_ssl_module</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"生成-ssl-秘钥对\"><a href=\"#生成-ssl-秘钥对\" class=\"headerlink\" title=\"生成 ssl 秘钥对\"></a>生成 ssl 秘钥对</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/nginx/conf</span><br><span class=\"line\"></span><br><span class=\"line\">yum install -y openssl</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"使用RSA算法生产key\"><a href=\"#使用RSA算法生产key\" class=\"headerlink\" title=\"使用RSA算法生产key\"></a>使用RSA算法生产key</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl genrsa -des3 -out tmp.key 2048</span><br><span class=\"line\"><span class=\"comment\"># 生成一个rsa类型的密钥，且长度为2048，但是我们有发现，让我们设置密码，如果每次有人访问我们的站点，都需要输入密码，太麻烦了</span></span><br></pre></td></tr></table></figure>\n\n<p>所以我们要转换私钥，取消密码（其实tmp.key与zhdy.key密钥内容是一样的，只不过一个有密码一个没有）：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl rsa -<span class=\"keyword\">in</span> tmp.key -out zhdy.key </span><br><span class=\"line\"></span><br><span class=\"line\">rm -f tmp.key</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建证书申请\"><a href=\"#创建证书申请\" class=\"headerlink\" title=\"创建证书申请\"></a>创建证书申请</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl req -new -key zhdy.key -out zhdy.csr</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"创建自签名的证书\"><a href=\"#创建自签名的证书\" class=\"headerlink\" title=\"创建自签名的证书\"></a>创建自签名的证书</h3><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl x509 -req -days 365 -<span class=\"keyword\">in</span> zhdy.csr -signkey zhdy.key -out zhdy.crt</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"Nginx-配置-ssl\"><a href=\"#Nginx-配置-ssl\" class=\"headerlink\" title=\"Nginx 配置 ssl\"></a>Nginx 配置 ssl</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    listen 443;</span><br><span class=\"line\">    server_name huguobo.site; <span class=\"comment\"># 换成你自己的域名服务哟</span></span><br><span class=\"line\">    index index.html index.php;</span><br><span class=\"line\">    root /path/to/your/file </span><br><span class=\"line\">    ssl on;</span><br><span class=\"line\">    ssl_certificate zhdy.crt;</span><br><span class=\"line\">    ssl_certificate_key zhdy.key;</span><br><span class=\"line\">    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># ssl on; 代表着打开ssl</span></span><br><span class=\"line\"><span class=\"comment\">#ssl_certificate zhdy.crt; 公钥</span></span><br><span class=\"line\"><span class=\"comment\"># ssl_certificate_key zhdy.key; 私钥</span></span><br><span class=\"line\"><span class=\"comment\"># ssl_protocols TLSv1 TLSv1.1 TLSv1.2; 三种不同的协议</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h2><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -t</span><br><span class=\"line\">nginx restart</span><br></pre></td></tr></table></figure>\n\n<p>由于已经设置了443，所以我们使用curl -x 是不生效的。<br>我们修改下/etc/hosts为: <code>yourip www.aaa.com</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">curl https://haha.com</span><br></pre></td></tr></table></figure>\n\n<p>报错显示为“此证书非安全证书”，但是ssl是已经成功配置了</p>\n<h2 id=\"其他方式（更快捷）\"><a href=\"#其他方式（更快捷）\" class=\"headerlink\" title=\"其他方式（更快捷）\"></a>其他方式（更快捷）</h2><p>后来发现各个厂商也提供申请证书的入口，也提供 DNS 和 文件验证两种配置,大家也可以自行参考配置<br><a href=\"https://console.cloud.tencent.com/ssl\" target=\"_blank\" rel=\"noopener\">腾讯云ssl控制台</a><br><a href=\"https://cloud.tencent.com/document/product/400/35244\" target=\"_blank\" rel=\"noopener\">nginx配置文档</a></p>\n<p>这种从供应商处可以直接下载到证书，然后nginx的配置秘钥和证书都在 nginx 文件夹下</p>\n<p>从客户端传送文件到云主机（MAC）</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">scp  ./2_huguobo.site.key ./1_huguobo.site_bundle.crt  root@118.24.215.220:/usr/<span class=\"built_in\">local</span>/nginx/conf</span><br></pre></td></tr></table></figure>\n\n<p>登录云主机 nginx 配置</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Settings for a TLS enabled server.</span></span><br><span class=\"line\"></span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        listen       443 ssl http2 default_server;</span><br><span class=\"line\">        listen       [::]:443 ssl http2 default_server;</span><br><span class=\"line\">        server_name  huguobo.site;</span><br><span class=\"line\"></span><br><span class=\"line\">        ssl on;</span><br><span class=\"line\">        ssl_certificate <span class=\"string\">\"/usr/local/nginx/conf/1_huguobo.site_bundle.crt\"</span>;</span><br><span class=\"line\">        ssl_certificate_key <span class=\"string\">\"/usr/local/nginx/conf/2_huguobo.site.key\"</span>;</span><br><span class=\"line\">        ssl_session_cache shared:SSL:1m;</span><br><span class=\"line\">        ssl_session_timeout  10m;</span><br><span class=\"line\">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class=\"line\">        ssl_prefer_server_ciphers on;</span><br><span class=\"line\">        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; <span class=\"comment\">#请按照这个套件配置，配置加密套件，写法遵循 openssl 标准。</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\"># Load configuration files for the default server block.</span></span><br><span class=\"line\">        include /etc/nginx/default.d/*.conf;</span><br><span class=\"line\"></span><br><span class=\"line\">        location / &#123;</span><br><span class=\"line\">           root /home/hexoBlog; <span class=\"comment\"># your path</span></span><br><span class=\"line\">           index index.html;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        error_page 404 /404.html;</span><br><span class=\"line\">            location = /40x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        error_page 500 502 503 504 /50x.html;</span><br><span class=\"line\">            location = /50x.html &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"强制HTTPS\"><a href=\"#强制HTTPS\" class=\"headerlink\" title=\"强制HTTPS\"></a>强制HTTPS</h2><p>我没有做强制https。但是需要的话，改下 nginx 配置文件即可<br>http 默认是<code>80</code>端口 ，https 是<code>443</code>端口</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">server&#123;</span><br><span class=\"line\">      listen 80;    <span class=\"comment\">#表示监听80端口</span></span><br><span class=\"line\">      server_name huguobo.site</span><br><span class=\"line\">      location / &#123;    <span class=\"comment\">#将80端口强制转为https</span></span><br><span class=\"line\">          rewrite (.*) https://huguobo.site<span class=\"variable\">$1</span> permanent;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n"},{"title":"程序员夫妇的周末","date":"2019-09-01T02:40:28.000Z","_content":"\n![weekend](/images/weekend.jpeg)\n\nhave a nice day~","source":"_posts/weekend.md","raw":"---\ntitle: 程序员夫妇的周末\ndate: 2019-09-01 10:40:28\ntags:\n- 日常\n- 白话\n---\n\n![weekend](/images/weekend.jpeg)\n\nhave a nice day~","slug":"weekend","published":1,"updated":"2019-09-01T02:56:41.461Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck00w6z1l0005ocoxy5ez68xj","content":"<p><img src=\"/images/weekend.jpeg\" alt=\"weekend\"></p>\n<p>have a nice day~</p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/images/weekend.jpeg\" alt=\"weekend\"></p>\n<p>have a nice day~</p>\n"},{"title":"关于这个网站","date":"2019-08-30T07:53:09.000Z","_content":"\n## WHAT\n个人生活记录网站。(希望能通过备案)\n希望把所有有意义的东西都记录下来，包括但不限于技术范围。\n个人使用，能帮助到人就更好了。\n\n\n## WHY\n上学时候的 [Blog](http://huguobo.github.io) 用的是 [jekyll](https://jekyllrb.com/)+ [GithubPages](https://pages.github.com/)。\n好久没有更新和维护了, 不是很熟悉 ruby，也不想继续浪费 github 的资源。\n加上发觉自己工作后的积累和沉淀明显不够，开始着手使用基于 [node](https://nodejs.org) 的 [hexo](https://hexo.io/zh-cn/) 和自己的云服务器搭建了这个网站。\n\n## HOW\n富强、民主、文明、和谐、自由、平等、公正、法治、爱国、敬业、诚信、友善。\n合法、合规、合理。\nLOVE AND PEACE。","source":"_posts/新网站.md","raw":"---\ntitle: 关于这个网站\ndate: 2019-08-30 15:53:09\ntags: \n- 白话\n---\n\n## WHAT\n个人生活记录网站。(希望能通过备案)\n希望把所有有意义的东西都记录下来，包括但不限于技术范围。\n个人使用，能帮助到人就更好了。\n\n\n## WHY\n上学时候的 [Blog](http://huguobo.github.io) 用的是 [jekyll](https://jekyllrb.com/)+ [GithubPages](https://pages.github.com/)。\n好久没有更新和维护了, 不是很熟悉 ruby，也不想继续浪费 github 的资源。\n加上发觉自己工作后的积累和沉淀明显不够，开始着手使用基于 [node](https://nodejs.org) 的 [hexo](https://hexo.io/zh-cn/) 和自己的云服务器搭建了这个网站。\n\n## HOW\n富强、民主、文明、和谐、自由、平等、公正、法治、爱国、敬业、诚信、友善。\n合法、合规、合理。\nLOVE AND PEACE。","slug":"新网站","published":1,"updated":"2019-08-31T08:36:12.599Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ck00w6z1m0006ocoxah7c3n03","content":"<h2 id=\"WHAT\"><a href=\"#WHAT\" class=\"headerlink\" title=\"WHAT\"></a>WHAT</h2><p>个人生活记录网站。(希望能通过备案)<br>希望把所有有意义的东西都记录下来，包括但不限于技术范围。<br>个人使用，能帮助到人就更好了。</p>\n<h2 id=\"WHY\"><a href=\"#WHY\" class=\"headerlink\" title=\"WHY\"></a>WHY</h2><p>上学时候的 <a href=\"http://huguobo.github.io\" target=\"_blank\" rel=\"noopener\">Blog</a> 用的是 <a href=\"https://jekyllrb.com/\" target=\"_blank\" rel=\"noopener\">jekyll</a>+ <a href=\"https://pages.github.com/\" target=\"_blank\" rel=\"noopener\">GithubPages</a>。<br>好久没有更新和维护了, 不是很熟悉 ruby，也不想继续浪费 github 的资源。<br>加上发觉自己工作后的积累和沉淀明显不够，开始着手使用基于 <a href=\"https://nodejs.org\" target=\"_blank\" rel=\"noopener\">node</a> 的 <a href=\"https://hexo.io/zh-cn/\" target=\"_blank\" rel=\"noopener\">hexo</a> 和自己的云服务器搭建了这个网站。</p>\n<h2 id=\"HOW\"><a href=\"#HOW\" class=\"headerlink\" title=\"HOW\"></a>HOW</h2><p>富强、民主、文明、和谐、自由、平等、公正、法治、爱国、敬业、诚信、友善。<br>合法、合规、合理。<br>LOVE AND PEACE。</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"WHAT\"><a href=\"#WHAT\" class=\"headerlink\" title=\"WHAT\"></a>WHAT</h2><p>个人生活记录网站。(希望能通过备案)<br>希望把所有有意义的东西都记录下来，包括但不限于技术范围。<br>个人使用，能帮助到人就更好了。</p>\n<h2 id=\"WHY\"><a href=\"#WHY\" class=\"headerlink\" title=\"WHY\"></a>WHY</h2><p>上学时候的 <a href=\"http://huguobo.github.io\" target=\"_blank\" rel=\"noopener\">Blog</a> 用的是 <a href=\"https://jekyllrb.com/\" target=\"_blank\" rel=\"noopener\">jekyll</a>+ <a href=\"https://pages.github.com/\" target=\"_blank\" rel=\"noopener\">GithubPages</a>。<br>好久没有更新和维护了, 不是很熟悉 ruby，也不想继续浪费 github 的资源。<br>加上发觉自己工作后的积累和沉淀明显不够，开始着手使用基于 <a href=\"https://nodejs.org\" target=\"_blank\" rel=\"noopener\">node</a> 的 <a href=\"https://hexo.io/zh-cn/\" target=\"_blank\" rel=\"noopener\">hexo</a> 和自己的云服务器搭建了这个网站。</p>\n<h2 id=\"HOW\"><a href=\"#HOW\" class=\"headerlink\" title=\"HOW\"></a>HOW</h2><p>富强、民主、文明、和谐、自由、平等、公正、法治、爱国、敬业、诚信、友善。<br>合法、合规、合理。<br>LOVE AND PEACE。</p>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[{"post_id":"ck00w6z1e0000ocoxn3ef7zp3","tag_id":"ck00w6z1k0004ocox4htv3ly4","_id":"ck00w6z1p000bocoxv0tj9uid"},{"post_id":"ck00w6z1e0000ocoxn3ef7zp3","tag_id":"ck00w6z1n0007ocoxfe65ao4r","_id":"ck00w6z1p000cocoxiyvt5kmb"},{"post_id":"ck00w6z1e0000ocoxn3ef7zp3","tag_id":"ck00w6z1o0008ocoxv5hmutdq","_id":"ck00w6z1p000eocox5efjjruh"},{"post_id":"ck00w6z1e0000ocoxn3ef7zp3","tag_id":"ck00w6z1o0009ocoxox4p0y20","_id":"ck00w6z1p000focox5zyadyls"},{"post_id":"ck00w6z1i0002ocox2bu3e87d","tag_id":"ck00w6z1p000aocoxebxxlmgg","_id":"ck00w6z1q000hocox5et6maj7"},{"post_id":"ck00w6z1i0002ocox2bu3e87d","tag_id":"ck00w6z1p000docoxbdkdqrtc","_id":"ck00w6z1r000iocoxt17c69t0"},{"post_id":"ck00w6z1l0005ocoxy5ez68xj","tag_id":"ck00w6z1q000gocox18kwi7es","_id":"ck00w6z1t000locoxgetfm07t"},{"post_id":"ck00w6z1l0005ocoxy5ez68xj","tag_id":"ck00w6z1r000jocoxqtni5pd4","_id":"ck00w6z1t000mocoxr18404wr"},{"post_id":"ck00w6z1m0006ocoxah7c3n03","tag_id":"ck00w6z1r000jocoxqtni5pd4","_id":"ck00w6z1t000nocoxrz9r4n83"}],"Tag":[{"name":"travis","_id":"ck00w6z1k0004ocox4htv3ly4"},{"name":"CI","_id":"ck00w6z1n0007ocoxfe65ao4r"},{"name":"hexo","_id":"ck00w6z1o0008ocoxv5hmutdq"},{"name":"blog","_id":"ck00w6z1o0009ocoxox4p0y20"},{"name":"nginx","_id":"ck00w6z1p000aocoxebxxlmgg"},{"name":"devOps","_id":"ck00w6z1p000docoxbdkdqrtc"},{"name":"日常","_id":"ck00w6z1q000gocox18kwi7es"},{"name":"白话","_id":"ck00w6z1r000jocoxqtni5pd4"}]}}